# 1.7 自定义导出（配置说明）

## 配置入口
- **T_COST_EXPORT_CONFIG**（主表导出配置）
- **T_COST_EXPORT_CONFIG_DETAIL**（明细 Sheet 配置）

## 核心字段说明
### T_COST_EXPORT_CONFIG
- exportCode / exportName / pageCode：导出标识与页面绑定
- masterSql：主表查询 SQL（可留空，系统可用默认拼装）
- masterTableAlias / pageViewAlias：SQL 别名
- pkColumn：主表主键列（用于关联明细）
- pageFkColumn：页面视图关联列
- masterLinkColumn：主表用于拼接超链接的列
- columns：列配置 JSON（字段、标题、顺序、是否可见）
- masterSheetName：主表 Sheet 名称

### T_COST_EXPORT_CONFIG_DETAIL
- exportConfigId：关联主表导出配置
- tabKey：与前端 tabKey 对齐
- sheetName：明细 Sheet 名称
- detailSql：明细查询 SQL
- detailLinkColumn：明细超链接列（可覆盖主表）
- columns：明细列配置 JSON

## 列配置 JSON 示例
```json
[
  {"field":"name","header":"名称","order":1,"visible":true},
  {"field":"amount","header":"金额","order":2,"visible":true},
  {"field":"remark","header":"备注","order":3,"visible":false}
]
```

## 示例 A：仅主表导出
```sql
INSERT INTO T_COST_EXPORT_CONFIG (
  ID, EXPORT_CODE, EXPORT_NAME, PAGE_CODE,
  MASTER_SQL, MASTER_TABLE_ALIAS, PK_COLUMN,
  COLUMNS, MASTER_SHEET_NAME, DISPLAY_ORDER, CREATE_BY
) VALUES (
  SEQ_COST_EXPORT_CONFIG.NEXTVAL,
  'COST_MASTER_EXPORT',
  '成本主表导出',
  'cost-demo',
  'SELECT * FROM V_COST_MASTER',
  'm',
  'ID',
  '[{"field":"name","header":"名称","order":1,"visible":true},{"field":"amount","header":"金额","order":2,"visible":true}]',
  '主表',
  1,
  'system'
);
```

## 示例 B：主表 + 明细多 Sheet
```sql
-- 主表
INSERT INTO T_COST_EXPORT_CONFIG (
  ID, EXPORT_CODE, EXPORT_NAME, PAGE_CODE, MASTER_SQL, MASTER_TABLE_ALIAS, PK_COLUMN, COLUMNS, MASTER_SHEET_NAME, DISPLAY_ORDER, CREATE_BY
) VALUES (
  SEQ_COST_EXPORT_CONFIG.NEXTVAL,
  'COST_FULL_EXPORT',
  '成本全量导出',
  'cost-demo',
  'SELECT * FROM V_COST_MASTER',
  'm',
  'ID',
  '[{"field":"name","header":"名称","order":1,"visible":true}]',
  '主表',
  1,
  'system'
);

-- 明细 Sheet
INSERT INTO T_COST_EXPORT_CONFIG_DETAIL (
  ID, EXPORT_CONFIG_ID, TAB_KEY, SHEET_NAME, DETAIL_SQL, MASTER_TABLE_ALIAS, DETAIL_TABLE_ALIAS, DETAIL_LINK_COLUMN, COLUMNS, DISPLAY_ORDER
) VALUES (
  SEQ_COST_EXPORT_CONFIG_DETAIL.NEXTVAL,
  :exportConfigId,
  'material',
  '原料明细',
  'SELECT d.* FROM V_COST_DETAIL d WHERE d.MASTER_ID = :masterId',
  'm',
  'd',
  'MATERIAL_CODE',
  '[{"field":"materialCode","header":"原料编码","order":1,"visible":true},{"field":"costBatch","header":"成本","order":2,"visible":true}]',
  1
);
```

## 多种配置情况
1) **只导出当前筛选结果**：前端选择“导出当前”，会携带筛选/排序条件。
2) **多 Sheet**：在 detail 表中按 tabKey 配多条。
3) **隐藏列**：`visible:false` 即导出时跳过。

## 注意事项
- 前端菜单会在检测到自定义导出配置后自动增加“自定义导出”子菜单。
- `columns` JSON 未配置时，会尝试按明细数据列推断；建议明确配置。
