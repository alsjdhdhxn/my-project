# 2.5 执行器服务（Action）配置说明

## 配置入口
- **T_COST_TABLE_METADATA.ACTION_RULES**（JSON 数组）

## 规则结构（ActionRule）
```json
{
  "order": 1,
  "code": "APPROVE",
  "name": "审核",
  "group": "toolbar",
  "enabled": true,
  "type": "sql",          
  "sql": "UPDATE T_COST_MASTER SET STATUS = '已审核' WHERE ID = ${id}",
  "description": "主表审核"
}
```

### 支持的 type
- `sql`：执行 SQL
- `java`：执行 Spring Bean 方法（method = beanName.methodName）
- `proc`：执行存储过程（procedure + params）

## 示例 A：SQL 执行器
```sql
UPDATE T_COST_TABLE_METADATA
SET ACTION_RULES = '[
  {"order":1,"code":"APPROVE","group":"toolbar","enabled":true,
   "type":"sql","sql":"UPDATE T_COST_MASTER SET STATUS = ''已审核'' WHERE ID = ${id}"}
]'
WHERE TABLE_CODE = 'CostMaster';
```

## 示例 B：Java 执行器
```json
[
  {"order":1,"code":"SYNC","type":"java","method":"costActionHandler.sync","enabled":true}
]
```

## 示例 C：存储过程执行器
```json
[
  {
    "order":1,
    "code":"CALC_PROC",
    "type":"proc",
    "procedure":"PKG_COST.CALC_COST",
    "params":[
      {"name":"P_ID","mode":"IN","jdbcType":"NUMERIC","source":"id"},
      {"name":"P_MSG","mode":"OUT","jdbcType":"VARCHAR","target":"msg"}
    ]
  }
]
```

## 触发方式
- 前端按钮：componentConfig.action = "APPROVE" + tableCode
- 接口调用：POST `/api/data/{tableCode}/execute`
```json
{"group":"toolbar","actionCodes":["APPROVE"],"data":{"id":1001},"validate":true}
```

## 注意事项
- 若同时传 group 与 actionCodes，会优先按 actionCodes 过滤。
- validate=true 会先走后端验证（validationRules）。
