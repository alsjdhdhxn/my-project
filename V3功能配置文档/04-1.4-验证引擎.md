# 1.4 验证引擎（配置说明）

## 配置入口
1) **列级 rulesConfig（简单校验）**
- 在列元数据的 rulesConfig 或 COLUMN_OVERRIDE.rulesConfig 中配置 validation
2) **页面规则 VALIDATION（高级/集中配置）**
- T_COST_PAGE_RULE，按 componentKey 区分主表/明细

## 支持的验证字段
- required：必填
- notZero：非零
- min / max：数值范围
- pattern：正则表达式
- message：自定义提示

## 示例 A：列 rulesConfig（必填 + 正则）
```sql
INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)
VALUES (
  SEQ_COST_PAGE_RULE.NEXTVAL,
  'cost-demo',
  'masterGrid',
  'COLUMN_OVERRIDE',
  q'~[
    {"field":"materialCode","rulesConfig":{"validation":{"required":true,"pattern":"^[A-Z0-9_-]+$","message":"编码格式错误"}}},
    {"field":"qty","rulesConfig":{"validation":{"required":true,"notZero":true,"min":0}}}
  ]~',
  'system'
);
```

## 示例 B：页面规则 VALIDATION（主表）
```sql
INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)
VALUES (
  SEQ_COST_PAGE_RULE.NEXTVAL,
  'cost-demo',
  'masterGrid',
  'VALIDATION',
  q'~[
    {"field":"name","required":true,"message":"名称必填"},
    {"field":"amount","min":0,"max":999999}
  ]~',
  'system'
);
```

## 示例 C：页面规则 VALIDATION（明细 Tab）
```sql
INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)
VALUES (
  SEQ_COST_PAGE_RULE.NEXTVAL,
  'cost-demo',
  'material',
  'VALIDATION',
  q'~[
    {"field":"qty","required":true,"notZero":true},
    {"field":"price","min":0}
  ]~',
  'system'
);
```

## 多种配置情况
1) **仅列 rulesConfig**：最简单，随列走。
2) **仅 VALIDATION 规则**：统一集中维护（优先级高于列 rulesConfig）。
3) **主表/明细分别配置**：componentKey = masterGrid / tabKey。

## 注意事项
- 如果配置了 VALIDATION 规则，则优先使用规则配置；否则从列元数据的 rulesConfig 中提取验证规则。
- 验证错误会格式化显示为“行 x: ...”，并阻止保存。
