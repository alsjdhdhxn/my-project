# 2.2 主从表保存（使用说明）

## 接口
- POST `/api/data/save`：推荐（支持变更追踪、乐观锁）
- POST `/api/data/master-detail`：兼容旧格式

## /api/data/save 请求结构（SaveParam）
```json
{
  "pageCode": "cost-demo",
  "master": {
    "id": 1001,
    "status": "modified",
    "data": {"id":1001,"name":"新名称","amount":200},
    "changes": [
      {"field":"name","oldValue":"旧名称","newValue":"新名称","changeType":"user"}
    ]
  },
  "details": {
    "CostDetail": [
      {
        "id": null,
        "status": "added",
        "data": {"masterId":1001,"item":"原料A","qty":10},
        "changes": [
          {"field":"qty","oldValue":0,"newValue":10,"changeType":"user"}
        ]
      }
    ]
  }
}
```

## /api/data/save 响应
```json
{
  "masterId": 1001,
  "idMapping": {"-1": 20001}
}
```

## /api/data/master-detail（旧格式）
```json
{
  "masterTableCode":"CostMaster",
  "master":{"tempId":-1,"name":"新主表"},
  "details":[
    {"tableCode":"CostDetail","rows":[{"tempId":-101,"masterTempId":-1,"item":"原料A"}]}
  ]
}
```

## 注意事项
- **临时 ID → 真实 ID** 会在响应中返回 `idMapping`。
- 乐观锁字段为 `updateTime`（如需要，请在 master/detail 中带上）。
- 从表外键会根据 `PARENT_FK_COLUMN` 自动填充。
