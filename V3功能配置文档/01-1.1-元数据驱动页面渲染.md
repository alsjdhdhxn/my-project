# 1.1 元数据驱动页面渲染（配置说明）

## 适用范围
- 通过 **T_COST_PAGE_COMPONENT** 组织页面组件树
- 通过 **T_COST_PAGE_RULE.RELATION / ROLE_BINDING** 指定主从关系、Split 参数、组件角色
- 通过 **componentConfig JSON** 控制 LAYOUT / GRID / TABS / FORM / BUTTON 的渲染参数

## 配置入口
1) **T_COST_PAGE_COMPONENT**
- PAGE_CODE / COMPONENT_KEY / COMPONENT_TYPE / PARENT_KEY / SORT_ORDER / REF_TABLE_CODE / COMPONENT_CONFIG
2) **T_COST_PAGE_RULE（可选）**
- RELATION：主从关系 + Split 参数
- ROLE_BINDING：角色绑定（MASTER_GRID / DETAIL_TABS）

## 关键字段说明（T_COST_PAGE_COMPONENT）
- COMPONENT_KEY：组件唯一标识（同一 pageCode 内不可重复）
- COMPONENT_TYPE：GRID / TABS / LAYOUT / MASTER_DETAIL / FORM / BUTTON
- PARENT_KEY：父组件 key（用于构建组件树）
- SORT_ORDER：同级排序
- REF_TABLE_CODE：GRID / TABS 默认表编码（主表/明细表）
- COMPONENT_CONFIG：JSON 字符串（布局/渲染参数）

## 示例 A：主从页面（嵌套模式）
```sql
-- 根节点
INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, SORT_ORDER, CREATE_BY)
VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-demo', '__root__', 'MASTER_DETAIL', 0, 'system');

-- 主表 Grid
INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-demo', 'masterGrid', 'GRID', '__root__', 'CostMaster', 10, 'system');

-- 明细 Tabs
INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, REF_TABLE_CODE, COMPONENT_CONFIG, SORT_ORDER, CREATE_BY)
VALUES (
  SEQ_COST_PAGE_COMPONENT.NEXTVAL,
  'cost-demo',
  'detailTabs',
  'TABS',
  '__root__',
  'CostDetail',
  q'~{
    "mode": "group",
    "groupField": "dtlType",
    "tabs": [
      {"key":"material","title":"原料","value":"原料","columns":["materialCode","materialName","qty","costBatch"]},
      {"key":"package","title":"包材","value":"包材","columns":["pkgCode","pkgName","qty","costBatch"]}
    ]
  }~',
  20,
  'system'
);
```

## 示例 B：主从页面（Split 模式）
```sql
-- RELATION 规则（Split 模式）
INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, SORT_ORDER, CREATE_BY)
VALUES (
  SEQ_COST_PAGE_RULE.NEXTVAL,
  'cost-demo',
  'masterGrid',
  'RELATION',
  '{"masterKey":"masterGrid","detailKey":"detailTabs","detailType":"split","splitConfig":{"defaultSize":0.6,"min":0.3,"max":0.85}}',
  0,
  'system'
);
```

## 示例 C：单表页面（仅 GRID）
```sql
INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-single', 'masterGrid', 'GRID', 'CostMaster', 0, 'system');
```

## 组件配置补充（常用）
- **LAYOUT.componentConfig**
```json
{"direction":"horizontal","gap":12,"align":"stretch","justify":"flex-start","width":"100%","height":"100%","fill":true}
```
- **GRID.componentConfig**（仅容器尺寸/样式）
```json
{"width":"100%","height":"calc(100vh - 120px)","className":"master-grid"}
```
- **FORM.componentConfig**
```json
{"rendererKey":"CostForm","placeholder":"请配置表单渲染器"}
```
- **BUTTON.componentConfig**
```json
{"label":"保存","type":"primary","action":"save"}
```

## 注意事项
- 组件树按 PARENT_KEY + SORT_ORDER 构建；缺失 parentKey 会成为根节点。
- MASTER_DETAIL 只是容器，真正主从关系由 RELATION / ROLE_BINDING 或默认推断。
- 统一渲染入口为 MetaPageRendererV3，Renderer Registry 自动注册，不需要额外配置。
- 组件级错误隔离/上报由 RendererBoundary 处理，DB 无需配置。
