# 成本管理系统开发计划

> 按顺序执行，完成一项勾选一项

---

## 一、登录认证（JWT）

- [x] 1.1 JwtUtil 工具类（生成 accessToken/refreshToken、解析、验证）
- [x] 1.2 AuthController（/auth/login、/auth/getUserInfo、/auth/refreshToken）
- [x] 1.3 JwtAuthenticationFilter（拦截请求、验证 token、注入用户上下文）
- [x] 1.4 SecurityConfig 配置（白名单、认证规则）
- [x] 1.5 前端对接登录，测试完整流程
- [x] 1.6 AdminPasswordInitializer 保留（用于重置密码）

---

## 二、动态菜单

- [ ] 2.1 后端：菜单接口（基于 T_COST_RESOURCE + 角色过滤）
- [ ] 2.2 前端：动态路由生成
- [ ] 2.3 前端：菜单权限控制

---

## 三、权限体系

- [ ] 3.1 页面权限接口（BUTTON_POLICY、COLUMN_POLICY）
- [ ] 3.2 数据权限拦截（T_COST_ROLE_PAGE_DATA_RULE → 查询注入过滤条件）
- [ ] 3.3 前端权限缓存与三层合并（基础层→限制层→偏好层）
- [ ] 3.4 用户偏好保存（T_COST_USER_GRID_CONFIG）

---

## 四、元数据驱动组件化

- [ ] 4.1 DynamicPage 渲染器（根据 pageCode 加载组件树递归渲染）
- [ ] 4.2 MetaGrid（AG Grid + 元数据列定义）
- [ ] 4.3 MetaForm（form-create + 元数据字段定义）
- [ ] 4.4 MetaFormDialog 弹窗表单（新增/编辑）
- [ ] 4.5 MetaButton 工具栏（按钮权限控制）
- [ ] 4.6 MetaLayout 布局容器

---

## 五、计算引擎（LogicEngine）

- [ ] 5.1 行级计算（RULES_CONFIG.calculate）
- [ ] 5.2 聚合计算（LOGIC_AGG：SUM/AVG/COUNT/MAX/MIN）
- [ ] 5.3 级联计算（聚合结果触发主表行级计算）
- [ ] 5.4 字段联动（LOGIC_FIELD：显隐/必填/只读/赋值）
- [ ] 5.5 数据回填（LOGIC_MAPPING：Lookup 选择后回填多字段）
- [ ] 5.6 状态锁定（LOGIC_STATE_LOCK：审批中禁止编辑）

---

## 六、弹窗选择器（Lookup）

- [ ] 6.1 后端：Lookup 配置接口（T_COST_LOOKUP_CONFIG）
- [ ] 6.2 前端：通用 Lookup 弹窗组件
- [ ] 6.3 前端：Lookup 与 LOGIC_MAPPING 集成

---

## 七、审计日志

- [ ] 7.1 T_COST_AUDIT_LOG 表创建
- [ ] 7.2 AuditLogService（字段变更对比、自然语言描述生成）
- [ ] 7.3 DynamicDataService 集成审计（AUDIT_ENABLED 开关）
- [ ] 7.4 审计日志查询页面

---

## 八、日志追踪（TLog）

- [ ] 8.1 TLog 集成配置（TraceId 自动打印）
- [ ] 8.2 前端请求携带 TraceId

---

## 九、审批流（Workflow）

- [ ] 9.1 流程定义表（T_COST_PROCESS_DEFINITION）
- [ ] 9.2 流程实例表（T_COST_PROCESS_INSTANCE）
- [ ] 9.3 待办任务表（T_COST_PROCESS_TASK）
- [ ] 9.4 审批历史表（T_COST_PROCESS_HISTORY）
- [ ] 9.5 流程引擎（提交、审批、驳回、撤回）
- [ ] 9.6 LOGIC_WORKFLOW 组件（流程挂载）
- [ ] 9.7 待办/已办列表页面
- [ ] 9.8 流程配置页面（可视化设计器，可选）

---

## 十、消息通知

- [ ] 10.1 T_COST_NOTIFICATION 表
- [ ] 10.2 SSE 推送服务
- [ ] 10.3 前端通知组件

---

## 十一、业务验证

- [ ] 11.1 CostDemo 单表 CRUD 验证
- [ ] 11.2 主从表页面验证
- [ ] 11.3 审批流业务验证
