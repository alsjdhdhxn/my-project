# 三层嵌套 Master-Detail 开发计划

## 目标

实现 AG Grid 原生三层嵌套：主表 → 汇总行 → 明细 Grid，支持变体列（同表不同分组显示不同列）。

---

## 阶段一：原型验证

- [ ] 新建 `MasterDetailNested.vue` 空壳组件
- [ ] 硬编码测试数据，验证 AG Grid v35 三层嵌套写法
- [ ] 确认展开/收起正常

## 阶段二：接入元数据

- [ ] 复用 `loadTableMeta()` 加载主表、从表元数据
- [ ] 复用 `parsePageComponents()` 解析页面配置
- [ ] 动态生成列定义

## 阶段三：接入真实数据

- [ ] 加载主表数据
- [ ] 展开时加载从表数据
- [ ] 按 groupField 分组生成汇总行

## 阶段四：汇总行计算

- [ ] Store 新增 `summaryRowsByGroup` computed
- [ ] 汇总行聚合计算
- [ ] 主表二级聚合

## 阶段五：编辑功能

- [ ] 明细行编辑触发计算链
- [ ] 汇总行自动重算
- [ ] 主表聚合更新

## 阶段六：保存功能

- [ ] 复用 `buildSaveParams()`
- [ ] 验证增删改场景

## 阶段七：变体列

- [ ] 后端增加 `VARIANT_KEY` 字段
- [ ] 前端按 groupKey 过滤列

## 阶段八：收尾

- [ ] 右键菜单
- [ ] 样式规则、变更高亮
- [ ] Lookup、快捷键

---

## 当前进度

**阶段一进行中...**
