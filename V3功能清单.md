# V3 版本功能清单

## 一、前端功能

### 1.1 元数据驱动页面渲染
- 页面组件树解析（T_COST_PAGE_COMPONENT）
- 列定义自动生成（T_COST_COLUMN_METADATA）
- Grid 配置自动绑定（rowModelType、columnDefs、rowSelection）
- 主从表布局支持（嵌套模式 / Split 模式）
- 统一渲染入口（MetaPageRendererV3）
- Renderer Registry 组件注册与匹配（import.meta.glob 自动注册、order/match）
- 组件级错误隔离与上报（RendererBoundary + reportComponentError）
- 组件状态管理（ready/loading/error）与占位/兜底展示

### 1.2 数据管理
- 主表 CRUD（新增、复制、删除、修改）
- 从表 CRUD（按 Tab 分组）
- 数据缓存管理（masterRows、detailCache）
- 临时 ID 生成与真实 ID 映射
- 保存状态锁（防止重复提交）
- 事务 API 更新 Grid（不刷新整个页面）

### 1.3 计算引擎
- 行级计算（字段变化触发公式计算）
- 聚合计算（从表汇总到主表）
- 级联计算（聚合结果触发主表计算）
- 主表广播到从表（broadcastFields）
- 变更追踪（_dirtyFields、_isNew、_isDeleted）

### 1.4 验证引擎
- 必填验证
- 格式验证（正则）
- 范围验证（min/max）
- 自定义验证规则
- 验证错误格式化显示

### 1.5 弹窗选择器（Lookup）
- 主表 Lookup 支持
- 从表 Lookup 支持
- 数据回填（fieldMapping）
- 回填后触发计算

### 1.6 右键菜单
- 主表右键菜单（新增、复制、删除、保存、导出）
- 从表右键菜单
- 可配置菜单项（T_COST_PAGE_RULE）
- 可选 action 白名单（静默跳过未定义的 action）

### 1.7 自定义导出
- 多 Sheet 导出（主表 + 从表）
- 自定义列配置
- 超链接支持
- 导出配置元数据驱动

### 1.8 用户偏好
- 列宽保存
- 列顺序保存
- 列显隐保存
- 按用户 + 页面 + Grid 存储

### 1.9 数据源支持
- Client-Side Row Model
- Infinite Row Model
- Server-Side Row Model (SSRM)
- 分页、排序、过滤条件构建
- SSRM/Infinite 数据源自动挂载（grid-ready 时设置 datasource）
- SSRM/Infinite 模式过滤刷新策略（refreshServerSide / purgeInfiniteCache）

### 1.10 组件扩展与交互能力
- 表单渲染器注册机制（form-renderer-registry）
- 按钮 Action 执行（action registry + executeAction 后备通道）
- 行级可编辑规则（ROW_EDITABLE）
- 行级样式规则（ROW_CLASS + 元数据 getRowClass）
- 单元格脏数据样式标记（_dirtyFields + cellClassRules）

---

## 二、后端功能

### 2.1 动态数据接口
- GET /{tableCode} - 分页查询
- POST /{tableCode}/search - 高级查询（条件、排序）
- GET /{tableCode}/all - 查询全部
- GET /{tableCode}/{id} - 查询单条
- POST /{tableCode} - 新增
- PUT /{tableCode}/{id} - 更新
- DELETE /{tableCode}/{id} - 删除（软删除）

### 2.2 主从表保存
- POST /master-detail - 主从表保存
- POST /save - 通用保存（支持变更追踪）
- 临时 ID → 真实 ID 映射返回
- 从表外键自动填充
- 乐观锁支持

### 2.3 元数据查询
- 表元数据查询（QUERY_VIEW、TARGET_TABLE、SEQUENCE_NAME）
- 列元数据查询（FIELD_NAME、QUERY_COLUMN、TARGET_COLUMN）
- 页面组件查询
- 页面规则查询

### 2.4 验证服务
- POST /{tableCode}/validate - 执行验证
- 验证规则从元数据加载
- 验证报告返回

### 2.5 执行器服务
- POST /{tableCode}/execute - 执行 Action
- Action 流程编排
- 执行报告返回

---

## 三、元数据配置

### 3.1 表元数据（T_COST_TABLE_METADATA）
- TABLE_CODE - 表编码
- QUERY_VIEW - 查询视图
- TARGET_TABLE - 保存表
- SEQUENCE_NAME - 序列名
- PK_COLUMN - 主键列
- PARENT_TABLE_CODE - 父表编码
- PARENT_FK_COLUMN - 外键列

### 3.2 列元数据（T_COST_COLUMN_METADATA）
- FIELD_NAME - 前端字段名
- COLUMN_NAME - 默认列名
- QUERY_COLUMN - 查询列名（视图）
- TARGET_COLUMN - 保存列名（表）
- DATA_TYPE - 数据类型
- EDITABLE / VISIBLE / REQUIRED

### 3.3 页面规则（T_COST_PAGE_RULE）
- CALC - 计算规则
- VALIDATION - 验证规则
- LOOKUP - 弹窗规则
- COLUMN_OVERRIDE - 列覆盖
- AGGREGATE - 聚合规则
- BROADCAST - 广播规则
- CONTEXT_MENU - 右键菜单
- SUMMARY_CONFIG / NESTED_CONFIG - 嵌套汇总配置
- ROLE_BINDING - 角色绑定
- RELATION - 关联配置（主从、Split 参数）
- GRID_OPTIONS / GRID_FEATURES - Grid 扩展配置（sideBar、cellSelection、groupBy 等）
- ROW_EDITABLE - 行级可编辑规则
- ROW_CLASS - 行级样式规则

### 3.4 页面组件（T_COST_PAGE_COMPONENT）
- GRID - 数据表格
- FORM - 动态表单
- BUTTON - 按钮
- LAYOUT - 布局容器
- TABS - 明细标签页
- MASTER_DETAIL - 主从布局
- LOGIC_AGG - 聚合逻辑
- LOGIC_FIELD - 字段联动

---

## 四、技术特性

### 4.1 AG Grid 集成
- 企业版功能（SSRM、Master/Detail）
- 事务 API（applyTransaction）
- 行样式（getRowClass）
- 单元格样式（cellStyle）
- 汇总行（pinnedBottomRowData）

### 4.2 响应式架构
- Vue 3 Composition API
- Ref / ShallowRef 状态管理
- Composables 模块化

### 4.3 运行时模式
- useSingleGridRuntime - 单表页面
- useMasterDetailRuntime - 主从页面
- useBaseRuntime - 基础运行时
