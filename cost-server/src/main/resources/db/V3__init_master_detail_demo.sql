-- =====================================================
-- 主从多Tab示例：成本单（主表） + 成本明细（从表1） + 费用明细（从表2）
-- =====================================================

-- 删除已有对象
BEGIN EXECUTE IMMEDIATE 'DROP TABLE T_COST_ORDER_FEE CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE T_COST_ORDER_DETAIL CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE T_COST_ORDER CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_COST_ORDER'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_COST_ORDER_DETAIL'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE SEQ_COST_ORDER_FEE'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

-- =====================================================
-- 1. 成本单主表
-- =====================================================
CREATE TABLE T_COST_ORDER (
    ID              NUMBER(19)      PRIMARY KEY,
    ORDER_NO        VARCHAR2(32)    NOT NULL UNIQUE,
    ORDER_DATE      DATE            NOT NULL,
    CUSTOMER_NAME   VARCHAR2(128),
    TOTAL_AMOUNT    NUMBER(18,2)    DEFAULT 0,
    TOTAL_FEE       NUMBER(18,2)    DEFAULT 0,
    STATUS          VARCHAR2(32)    DEFAULT 'DRAFT',
    REMARK          VARCHAR2(512),
    DELETED         NUMBER(1)       DEFAULT 0,
    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    UPDATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    CREATE_BY       VARCHAR2(64),
    UPDATE_BY       VARCHAR2(64)
);
CREATE SEQUENCE SEQ_COST_ORDER START WITH 1 INCREMENT BY 1;

-- =====================================================
-- 2. 成本明细从表
-- =====================================================
CREATE TABLE T_COST_ORDER_DETAIL (
    ID              NUMBER(19)      PRIMARY KEY,
    ORDER_ID        NUMBER(19)      NOT NULL,
    ITEM_NAME       VARCHAR2(128)   NOT NULL,
    SPEC            VARCHAR2(64),
    UNIT            VARCHAR2(32),
    QUANTITY        NUMBER(18,4)    DEFAULT 0,
    UNIT_PRICE      NUMBER(18,4)    DEFAULT 0,
    AMOUNT          NUMBER(18,2)    DEFAULT 0,
    REMARK          VARCHAR2(256),
    DELETED         NUMBER(1)       DEFAULT 0,
    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    UPDATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    CREATE_BY       VARCHAR2(64),
    UPDATE_BY       VARCHAR2(64),
    CONSTRAINT FK_DETAIL_ORDER FOREIGN KEY (ORDER_ID) REFERENCES T_COST_ORDER(ID)
);
CREATE SEQUENCE SEQ_COST_ORDER_DETAIL START WITH 1 INCREMENT BY 1;
CREATE INDEX IDX_DETAIL_ORDER_ID ON T_COST_ORDER_DETAIL(ORDER_ID);

-- =====================================================
-- 3. 费用明细从表
-- =====================================================
CREATE TABLE T_COST_ORDER_FEE (
    ID              NUMBER(19)      PRIMARY KEY,
    ORDER_ID        NUMBER(19)      NOT NULL,
    FEE_TYPE        VARCHAR2(32)    NOT NULL,
    FEE_NAME        VARCHAR2(128)   NOT NULL,
    FEE_AMOUNT      NUMBER(18,2)    DEFAULT 0,
    REMARK          VARCHAR2(256),
    DELETED         NUMBER(1)       DEFAULT 0,
    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    UPDATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,
    CREATE_BY       VARCHAR2(64),
    UPDATE_BY       VARCHAR2(64),
    CONSTRAINT FK_FEE_ORDER FOREIGN KEY (ORDER_ID) REFERENCES T_COST_ORDER(ID)
);
CREATE SEQUENCE SEQ_COST_ORDER_FEE START WITH 1 INCREMENT BY 1;
CREATE INDEX IDX_FEE_ORDER_ID ON T_COST_ORDER_FEE(ORDER_ID);

-- =====================================================
-- 4. 字典：费用类型
-- =====================================================
INSERT INTO T_COST_DICTIONARY_TYPE (ID, TYPE_CODE, TYPE_NAME, DESCRIPTION, CREATE_BY)
VALUES (SEQ_COST_DICT_TYPE.NEXTVAL, 'FEE_TYPE', '费用类型', '成本单费用类型', 'system');

DECLARE
    v_type_id NUMBER;
BEGIN
    SELECT ID INTO v_type_id FROM T_COST_DICTIONARY_TYPE WHERE TYPE_CODE = 'FEE_TYPE';
    
    INSERT INTO T_COST_DICTIONARY_ITEM (ID, TYPE_ID, ITEM_CODE, ITEM_NAME, ITEM_VALUE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_DICT_ITEM.NEXTVAL, v_type_id, 'TRANSPORT', '运输费', 'TRANSPORT', 1, 'system');
    INSERT INTO T_COST_DICTIONARY_ITEM (ID, TYPE_ID, ITEM_CODE, ITEM_NAME, ITEM_VALUE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_DICT_ITEM.NEXTVAL, v_type_id, 'PACKAGE', '包装费', 'PACKAGE', 2, 'system');
    INSERT INTO T_COST_DICTIONARY_ITEM (ID, TYPE_ID, ITEM_CODE, ITEM_NAME, ITEM_VALUE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_DICT_ITEM.NEXTVAL, v_type_id, 'TAX', '税费', 'TAX', 3, 'system');
    INSERT INTO T_COST_DICTIONARY_ITEM (ID, TYPE_ID, ITEM_CODE, ITEM_NAME, ITEM_VALUE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_DICT_ITEM.NEXTVAL, v_type_id, 'OTHER', '其他', 'OTHER', 4, 'system');
END;
/

-- =====================================================
-- 5. 表元数据
-- =====================================================
DECLARE
    v_master_id NUMBER;
    v_detail_id NUMBER;
    v_fee_id NUMBER;
BEGIN
    -- 主表元数据
    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_master_id FROM DUAL;
    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)
    VALUES (v_master_id, 'CostOrder', '成本单', 'T_COST_ORDER', 'T_COST_ORDER', 'SEQ_COST_ORDER', 'ID', 'system');
    
    -- 主表列
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'id', 'ID', 'ID', 'number', 0, 0, 0, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'orderNo', 'ORDER_NO', '单据编号', 'text', 1, 0, 1, 1, 150, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'orderDate', 'ORDER_DATE', '单据日期', 'date', 2, 1, 1, 1, 120, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'customerName', 'CUSTOMER_NAME', '客户名称', 'text', 3, 1, 0, 1, 180, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalAmount', 'TOTAL_AMOUNT', '成本合计', 'number', 4, 0, 0, 0, 120, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalFee', 'TOTAL_FEE', '费用合计', 'number', 5, 0, 0, 0, 120, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, DICT_TYPE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'status', 'STATUS', '状态', 'select', 6, 1, 0, 1, 'COST_STATUS', 100, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'remark', 'REMARK', '备注', 'text', 7, 1, 0, 0, 200, 'system');

    -- 明细从表元数据
    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_detail_id FROM DUAL;
    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)
    VALUES (v_detail_id, 'CostOrderDetail', '成本明细', 'T_COST_ORDER_DETAIL', 'T_COST_ORDER_DETAIL', 'SEQ_COST_ORDER_DETAIL', 'ID', 'CostOrder', 'ORDER_ID', 'system');
    
    -- 明细列
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'id', 'ID', 'ID', 'number', 0, 0, 0, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'orderId', 'ORDER_ID', '主表ID', 'number', 1, 0, 1, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'itemName', 'ITEM_NAME', '项目名称', 'text', 2, 1, 1, 0, 180, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'spec', 'SPEC', '规格', 'text', 3, 1, 0, 0, 100, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'unit', 'UNIT', '单位', 'text', 4, 1, 0, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, RULES_CONFIG, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'quantity', 'QUANTITY', '数量', 'number', 5, 1, 1, 0, 100, '{"calculate":{"triggerFields":["quantity","unitPrice"]}}', 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, RULES_CONFIG, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'unitPrice', 'UNIT_PRICE', '单价', 'number', 6, 1, 1, 0, 100, '{"calculate":{"triggerFields":["quantity","unitPrice"]}}', 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, RULES_CONFIG, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'amount', 'AMOUNT', '金额', 'number', 7, 0, 0, 0, 120, '{"calculate":{"expression":"quantity*unitPrice"}}', 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_detail_id, 'remark', 'REMARK', '备注', 'text', 8, 1, 0, 0, 150, 'system');

    -- 费用从表元数据
    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_fee_id FROM DUAL;
    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)
    VALUES (v_fee_id, 'CostOrderFee', '费用明细', 'T_COST_ORDER_FEE', 'T_COST_ORDER_FEE', 'SEQ_COST_ORDER_FEE', 'ID', 'CostOrder', 'ORDER_ID', 'system');
    
    -- 费用列
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'id', 'ID', 'ID', 'number', 0, 0, 0, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'orderId', 'ORDER_ID', '主表ID', 'number', 1, 0, 1, 0, 80, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, DICT_TYPE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'feeType', 'FEE_TYPE', '费用类型', 'select', 2, 1, 1, 0, 'FEE_TYPE', 120, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'feeName', 'FEE_NAME', '费用名称', 'text', 3, 1, 1, 0, 180, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'feeAmount', 'FEE_AMOUNT', '费用金额', 'number', 4, 1, 1, 0, 120, 'system');
    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, EDITABLE, REQUIRED, SEARCHABLE, WIDTH, CREATE_BY)
    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_fee_id, 'remark', 'REMARK', '备注', 'text', 5, 1, 0, 0, 150, 'system');

    COMMIT;
END;
/

-- =====================================================
-- 6. 页面组件配置：主从多Tab页面
-- =====================================================
BEGIN
    -- 根布局
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'root', 'LAYOUT', NULL, '{"type":"flex","direction":"column","gap":12}', 0, 'system');
    
    -- 查询表单
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'searchForm', 'FORM', 'root', '{"title":"查询条件"}', 'CostOrder', 1, 'system');
    
    -- 工具栏
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'toolbar', 'BUTTON', 'root', '{"targetGrid":"masterGrid","tableCode":"CostOrder"}', 2, 'system');
    
    -- 主表Grid
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'masterGrid', 'GRID', 'root', '{"height":250,"master":true}', 'CostOrder', 3, 'system');
    
    -- Tab容器
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'detailTabs', 'TABS', 'root', '{"masterGrid":"masterGrid"}', 4, 'system');
    
    -- Tab1: 成本明细
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'detailGrid', 'GRID', 'detailTabs', '{"tabLabel":"成本明细","height":250,"editable":true}', 'CostOrderDetail', 1, 'system');
    
    -- Tab2: 费用明细
    INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, COMPONENT_CONFIG, REF_TABLE_CODE, SORT_ORDER, CREATE_BY)
    VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-order', 'feeGrid', 'GRID', 'detailTabs', '{"tabLabel":"费用明细","height":250,"editable":true}', 'CostOrderFee', 2, 'system');

    COMMIT;
END;
/

-- =====================================================
-- 7. 菜单资源
-- =====================================================
INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)
VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'cost-order', '成本单', 'PAGE', 'cost-order', 'mdi:file-document-multiple-outline', '/cost/order', (SELECT ID FROM T_COST_RESOURCE WHERE RESOURCE_CODE = 'cost-manage'), 2, 'system');

COMMIT;

-- =====================================================
-- 8. 测试数据
-- =====================================================
DECLARE
    v_order_id NUMBER;
BEGIN
    -- 插入主表
    SELECT SEQ_COST_ORDER.NEXTVAL INTO v_order_id FROM DUAL;
    INSERT INTO T_COST_ORDER (ID, ORDER_NO, ORDER_DATE, CUSTOMER_NAME, TOTAL_AMOUNT, TOTAL_FEE, STATUS, REMARK, CREATE_BY)
    VALUES (v_order_id, 'CO202412001', SYSDATE, '测试客户A', 15000, 500, 'DRAFT', '测试数据', 'system');
    
    -- 插入明细
    INSERT INTO T_COST_ORDER_DETAIL (ID, ORDER_ID, ITEM_NAME, SPEC, UNIT, QUANTITY, UNIT_PRICE, AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_DETAIL.NEXTVAL, v_order_id, '原材料A', '规格1', '件', 100, 100, 10000, 'system');
    INSERT INTO T_COST_ORDER_DETAIL (ID, ORDER_ID, ITEM_NAME, SPEC, UNIT, QUANTITY, UNIT_PRICE, AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_DETAIL.NEXTVAL, v_order_id, '原材料B', '规格2', '箱', 50, 100, 5000, 'system');
    
    -- 插入费用
    INSERT INTO T_COST_ORDER_FEE (ID, ORDER_ID, FEE_TYPE, FEE_NAME, FEE_AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_FEE.NEXTVAL, v_order_id, 'TRANSPORT', '运输费', 300, 'system');
    INSERT INTO T_COST_ORDER_FEE (ID, ORDER_ID, FEE_TYPE, FEE_NAME, FEE_AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_FEE.NEXTVAL, v_order_id, 'PACKAGE', '包装费', 200, 'system');

    -- 第二条主表
    SELECT SEQ_COST_ORDER.NEXTVAL INTO v_order_id FROM DUAL;
    INSERT INTO T_COST_ORDER (ID, ORDER_NO, ORDER_DATE, CUSTOMER_NAME, TOTAL_AMOUNT, TOTAL_FEE, STATUS, REMARK, CREATE_BY)
    VALUES (v_order_id, 'CO202412002', SYSDATE-1, '测试客户B', 8000, 150, 'SUBMITTED', '已提交审批', 'system');
    
    INSERT INTO T_COST_ORDER_DETAIL (ID, ORDER_ID, ITEM_NAME, SPEC, UNIT, QUANTITY, UNIT_PRICE, AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_DETAIL.NEXTVAL, v_order_id, '配件C', '标准', '个', 80, 100, 8000, 'system');
    
    INSERT INTO T_COST_ORDER_FEE (ID, ORDER_ID, FEE_TYPE, FEE_NAME, FEE_AMOUNT, CREATE_BY)
    VALUES (SEQ_COST_ORDER_FEE.NEXTVAL, v_order_id, 'TAX', '税费', 150, 'system');

    COMMIT;
END;
/
