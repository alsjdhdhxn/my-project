-- =====================================================

-- 成本管理系统数据库初始化脚本

-- 用途：一次执行完成所有建表、初始化与配置

-- 页面：成本评估V2 + 系统管理（人员/角色）

-- =====================================================



-- 清理旧数据

BEGIN

  FOR v IN (

    SELECT view_name

      FROM user_views

     WHERE view_name LIKE 'V_COST_%'

        OR view_name LIKE 'T_COST_%_V'

        OR view_name = 'ERP_FORMONEY_V'

  ) LOOP

    EXECUTE IMMEDIATE 'DROP VIEW ' || v.view_name;

  END LOOP;

END;

/



BEGIN

  FOR t IN (SELECT table_name FROM user_tables WHERE table_name LIKE 'T_COST_%') LOOP

    EXECUTE IMMEDIATE 'DROP TABLE ' || t.table_name || ' CASCADE CONSTRAINTS';

  END LOOP;

END;

/



BEGIN

  FOR s IN (SELECT sequence_name FROM user_sequences WHERE sequence_name LIKE 'SEQ_COST_%') LOOP

    EXECUTE IMMEDIATE 'DROP SEQUENCE ' || s.sequence_name;

  END LOOP;

END;

/



-- =====================================================

-- A. 基础表结构

-- =====================================================



-- A1. 元数据模块表结构

CREATE TABLE T_COST_TABLE_METADATA (

    ID                  NUMBER(19)      PRIMARY KEY,

    TABLE_CODE          VARCHAR2(64)    NOT NULL UNIQUE,

    TABLE_NAME          VARCHAR2(128)   NOT NULL,

    QUERY_VIEW          VARCHAR2(64),

    TARGET_TABLE        VARCHAR2(64)    NOT NULL,

    SEQUENCE_NAME       VARCHAR2(64),

    PK_COLUMN           VARCHAR2(64)    DEFAULT 'ID',

    PARENT_TABLE_CODE   VARCHAR2(64),

    PARENT_FK_COLUMN    VARCHAR2(64),

    AUDIT_ENABLED       NUMBER(1)       DEFAULT 0,

    VALIDATION_RULES    CLOB,

    ACTION_RULES        CLOB,

    DESCRIPTION         VARCHAR2(500),

    DELETED             NUMBER(1)       DEFAULT 0,

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_TABLE_METADATA START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_COLUMN_METADATA (

    ID                  NUMBER(19)      PRIMARY KEY,

    TABLE_METADATA_ID   NUMBER(19)      NOT NULL,

    FIELD_NAME          VARCHAR2(64)    NOT NULL,

    COLUMN_NAME         VARCHAR2(64)    NOT NULL,

    QUERY_COLUMN        VARCHAR2(128),

    TARGET_COLUMN       VARCHAR2(64),

    HEADER_TEXT         VARCHAR2(128)   NOT NULL,

    DATA_TYPE           VARCHAR2(32)    DEFAULT 'text',

    DISPLAY_ORDER       NUMBER(5)       DEFAULT 0,

    SORTABLE            NUMBER(1)       DEFAULT 1,

    FILTERABLE          NUMBER(1)       DEFAULT 1,

    IS_VIRTUAL          NUMBER(1)       DEFAULT 0,

    DICT_TYPE           VARCHAR2(64),

    DELETED             NUMBER(1)       DEFAULT 0,

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64),

    CONSTRAINT FK_COLUMN_TABLE FOREIGN KEY (TABLE_METADATA_ID) REFERENCES T_COST_TABLE_METADATA(ID)

);

CREATE SEQUENCE SEQ_COST_COLUMN_METADATA START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_COLUMN_TABLE_ID ON T_COST_COLUMN_METADATA(TABLE_METADATA_ID);



-- 页面规则表（计算/验证/弹窗/列覆盖/聚合）

CREATE TABLE T_COST_PAGE_RULE (

    ID              NUMBER(19)      PRIMARY KEY,

    PAGE_CODE       VARCHAR2(64)    NOT NULL,

    COMPONENT_KEY   VARCHAR2(64)    NOT NULL,

    RULE_TYPE       VARCHAR2(32)    NOT NULL,

    RULES           CLOB            NOT NULL,

    SORT_ORDER      NUMBER(5)       DEFAULT 0,

    DESCRIPTION     VARCHAR2(200),

    DELETED         NUMBER(1)       DEFAULT 0,

    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY       VARCHAR2(64),

    UPDATE_BY       VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_PAGE_RULE START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_PAGE_RULE_PAGE ON T_COST_PAGE_RULE(PAGE_CODE);



CREATE TABLE T_COST_LOOKUP_CONFIG (

    ID                  NUMBER(19)      PRIMARY KEY,

    LOOKUP_CODE         VARCHAR2(64)    NOT NULL UNIQUE,

    LOOKUP_NAME         VARCHAR2(128)   NOT NULL,

    DATA_SOURCE         VARCHAR2(200)   NOT NULL,

    DISPLAY_COLUMNS     CLOB,

    SEARCH_COLUMNS      CLOB,

    VALUE_FIELD         VARCHAR2(64)    NOT NULL,

    LABEL_FIELD         VARCHAR2(64)    NOT NULL,

    DELETED             NUMBER(1)       DEFAULT 0,

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_LOOKUP_CONFIG START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_PAGE_COMPONENT (

    ID                  NUMBER(19)      PRIMARY KEY,

    PAGE_CODE           VARCHAR2(64)    NOT NULL,

    COMPONENT_KEY       VARCHAR2(64)    NOT NULL,

    COMPONENT_TYPE      VARCHAR2(32)    NOT NULL,

    PARENT_KEY          VARCHAR2(64),

    COMPONENT_CONFIG    CLOB,

    REF_TABLE_CODE      VARCHAR2(64),

    SLOT_NAME           VARCHAR2(32),

    SORT_ORDER          NUMBER(5)       DEFAULT 0,

    DELETED             NUMBER(1)       DEFAULT 0,

    DESCRIPTION         VARCHAR2(200),

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_PAGE_COMPONENT START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_PAGE_COMP_PAGE ON T_COST_PAGE_COMPONENT(PAGE_CODE);

CREATE UNIQUE INDEX UK_PAGE_COMP_KEY ON T_COST_PAGE_COMPONENT(PAGE_CODE, COMPONENT_KEY);



CREATE TABLE T_COST_DICTIONARY_TYPE (

    ID                  NUMBER(19)      PRIMARY KEY,

    TYPE_CODE           VARCHAR2(64)    NOT NULL UNIQUE,

    TYPE_NAME           VARCHAR2(128)   NOT NULL,

    DESCRIPTION         VARCHAR2(500),

    DELETED             NUMBER(1)       DEFAULT 0,

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_DICT_TYPE START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_DICTIONARY_ITEM (

    ID                  NUMBER(19)      PRIMARY KEY,

    TYPE_ID             NUMBER(19)      NOT NULL,

    ITEM_CODE           VARCHAR2(64)    NOT NULL,

    ITEM_NAME           VARCHAR2(128)   NOT NULL,

    ITEM_VALUE          VARCHAR2(200),

    SORT_ORDER          NUMBER(5)       DEFAULT 0,

    EXTRA_CONFIG        VARCHAR2(1000),

    DELETED             NUMBER(1)       DEFAULT 0,

    CREATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME         TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY           VARCHAR2(64),

    UPDATE_BY           VARCHAR2(64),

    CONSTRAINT FK_DICT_ITEM_TYPE FOREIGN KEY (TYPE_ID) REFERENCES T_COST_DICTIONARY_TYPE(ID)

);

CREATE SEQUENCE SEQ_COST_DICT_ITEM START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_DICT_ITEM_TYPE ON T_COST_DICTIONARY_ITEM(TYPE_ID);



COMMIT;



-- A2. 权限模块表结构

CREATE TABLE T_COST_DEPARTMENT (

    ID              NUMBER(19) PRIMARY KEY,

    DEPT_CODE       VARCHAR2(64) NOT NULL UNIQUE,

    DEPT_NAME       VARCHAR2(128) NOT NULL,

    PARENT_ID       NUMBER(19),

    SORT_ORDER      NUMBER(5) DEFAULT 0,

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY       VARCHAR2(64),

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_DEPARTMENT START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_USER (

    ID              NUMBER(19) PRIMARY KEY,

    USERNAME        VARCHAR2(64) NOT NULL UNIQUE,

    PASSWORD        VARCHAR2(256) NOT NULL,

    REAL_NAME       VARCHAR2(128),

    EMAIL           VARCHAR2(128),

    PHONE           VARCHAR2(32),

    DEPARTMENT_ID   NUMBER(19),

    STATUS          VARCHAR2(32) DEFAULT 'ACTIVE',

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY       VARCHAR2(64),

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_USER START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_ROLE (

    ID              NUMBER(19) PRIMARY KEY,

    ROLE_CODE       VARCHAR2(64) NOT NULL UNIQUE,

    ROLE_NAME       VARCHAR2(128) NOT NULL,

    DESCRIPTION     VARCHAR2(500),

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY       VARCHAR2(64),

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_ROLE START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_USER_ROLE (

    ID              NUMBER(19) PRIMARY KEY,

    USER_ID         NUMBER(19) NOT NULL,

    ROLE_ID         NUMBER(19) NOT NULL,

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_USER_ROLE START WITH 1 INCREMENT BY 1;

CREATE UNIQUE INDEX UK_USER_ROLE ON T_COST_USER_ROLE(USER_ID, ROLE_ID);



CREATE TABLE T_COST_ROLE_PAGE (

    ID              NUMBER(19) PRIMARY KEY,

    ROLE_ID         NUMBER(19) NOT NULL,

    PAGE_CODE       VARCHAR2(64) NOT NULL,

    BUTTON_POLICY   VARCHAR2(1000),

    COLUMN_POLICY   CLOB,

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY       VARCHAR2(64),

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_ROLE_PAGE START WITH 1 INCREMENT BY 1;

CREATE UNIQUE INDEX UK_ROLE_PAGE ON T_COST_ROLE_PAGE(ROLE_ID, PAGE_CODE);



CREATE TABLE T_COST_ROLE_PAGE_DATA_RULE (

    ID              NUMBER(19) PRIMARY KEY,

    ROLE_PAGE_ID    NUMBER(19) NOT NULL,

    RULE_TYPE       VARCHAR2(32) NOT NULL,

    RULE_CONFIG     CLOB NOT NULL,

    PRIORITY        NUMBER(3) DEFAULT 0,

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_DATA_RULE START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_USER_GRID_CONFIG (

    ID              NUMBER(19) PRIMARY KEY,

    USER_ID         NUMBER(19) NOT NULL,

    PAGE_CODE       VARCHAR2(64) NOT NULL,

    GRID_KEY        VARCHAR2(64) NOT NULL,

    CONFIG_DATA     CLOB,

    DELETED         NUMBER(1) DEFAULT 0,

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_USER_GRID START WITH 1 INCREMENT BY 1;

CREATE UNIQUE INDEX UK_USER_GRID_CONF ON T_COST_USER_GRID_CONFIG(USER_ID, PAGE_CODE, GRID_KEY);



-- 自定义导出配置主表

CREATE TABLE T_COST_EXPORT_CONFIG (

    ID                  NUMBER(19) PRIMARY KEY,

    EXPORT_CODE         VARCHAR2(100) NOT NULL,        -- 导出配置编码（唯一）

    EXPORT_NAME         VARCHAR2(200) NOT NULL,        -- 导出名称（显示给用户）

    PAGE_CODE           VARCHAR2(100) NOT NULL,        -- 关联页面

    

    -- 主表 SQL 配置

    MASTER_SQL          CLOB NOT NULL,                 -- master SQL must reference masterTableAlias.pkColumn for current export

    MASTER_TABLE_ALIAS  VARCHAR2(50),                  -- 主表别名（用于 EXISTS 拼接）

    PK_COLUMN           VARCHAR2(100),                 -- 主表主键列（关联页面视图）

    PAGE_VIEW_ALIAS     VARCHAR2(50) DEFAULT 'p',      -- 页面视图别名

    PAGE_FK_COLUMN      VARCHAR2(100),                 -- 页面视图中的关联字段

    MASTER_LINK_COLUMN  VARCHAR2(100),                 -- master link column for hyperlink

    

    -- 列配置 JSON: [{"field":"xxx","header":"xxx","order":1,"visible":true}, ...]

    COLUMNS             CLOB,

    

    -- Sheet 配置

    MASTER_SHEET_NAME   VARCHAR2(100) DEFAULT 'master',

    

    DISPLAY_ORDER       NUMBER(5) DEFAULT 0,

    DELETED             NUMBER(1) DEFAULT 0,

    CREATE_BY           VARCHAR2(64),

    CREATE_TIME         TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY           VARCHAR2(64),

    UPDATE_TIME         TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_EXPORT_CONFIG START WITH 1 INCREMENT BY 1;

CREATE UNIQUE INDEX UK_EXPORT_CONFIG_CODE ON T_COST_EXPORT_CONFIG(EXPORT_CODE);

CREATE INDEX IDX_EXPORT_CONFIG_PAGE ON T_COST_EXPORT_CONFIG(PAGE_CODE);



-- 自定义导出配置从表

CREATE TABLE T_COST_EXPORT_CONFIG_DETAIL (

    ID                  NUMBER(19) PRIMARY KEY,

    EXPORT_CONFIG_ID    NUMBER(19) NOT NULL,           -- 关联主表

    TAB_KEY             VARCHAR2(100),                 -- 从表标识

    SHEET_NAME          VARCHAR2(100),                 -- Excel Sheet 名称

    

    -- 从表 SQL 配置

    DETAIL_SQL          CLOB NOT NULL,                 -- detail SQL must reference masterTableAlias for current export

    MASTER_TABLE_ALIAS  VARCHAR2(50),                  -- SQL 中主表的别名

    DETAIL_TABLE_ALIAS  VARCHAR2(50),                  -- SQL 中从表的别名

    DETAIL_LINK_COLUMN  VARCHAR2(100),                 -- detail link column for hyperlink

    

    -- 列配置 JSON

    COLUMNS             CLOB,

    

    DISPLAY_ORDER       NUMBER(5) DEFAULT 0,

    

    CONSTRAINT FK_EXPORT_DTL_CONFIG FOREIGN KEY (EXPORT_CONFIG_ID) REFERENCES T_COST_EXPORT_CONFIG(ID)

);

CREATE SEQUENCE SEQ_COST_EXPORT_CONFIG_DTL START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_EXPORT_DTL_CONFIG ON T_COST_EXPORT_CONFIG_DETAIL(EXPORT_CONFIG_ID);



CREATE TABLE T_COST_RESOURCE (

    ID              NUMBER(19) PRIMARY KEY,

    RESOURCE_CODE   VARCHAR2(64) NOT NULL UNIQUE,

    RESOURCE_NAME   VARCHAR2(128) NOT NULL,

    RESOURCE_TYPE   VARCHAR2(20) NOT NULL,

    PAGE_CODE       VARCHAR2(64),

    ICON            VARCHAR2(64),

    ROUTE           VARCHAR2(128),

    PARENT_ID       NUMBER(19),

    SORT_ORDER      NUMBER(5) DEFAULT 0,

    DELETED         NUMBER(1) DEFAULT 0,

    CREATE_BY       VARCHAR2(64),

    CREATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_BY       VARCHAR2(64),

    UPDATE_TIME     TIMESTAMP DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_RESOURCE START WITH 1 INCREMENT BY 1;



COMMIT;





-- A3. 业务模块表结构

CREATE TABLE T_COST_PINGGU (

    GOODSID       NUMBER,

    GOODSNAME     VARCHAR2(100),

    STRENGTH      VARCHAR2(50),

    MA_NO         VARCHAR2(30),

    APEX_PL       NUMBER,

    MAH           VARCHAR2(100),

    P_PERPACK     NUMBER,

    FORM          VARCHAR2(20),

    S_PERBACK     NUMBER,

    PACKTYPE      VARCHAR2(30),

    X_PERBACK     NUMBER,

    TOTAL_FL      NUMBER,

    TOTAL_BC      NUMBER,

    TOTAL_YL      NUMBER,

    MEMO          VARCHAR2(100),

    USESTATUS     VARCHAR2(100) DEFAULT 0,

    DOCID         NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,

    DOSAGE        VARCHAR2(20),

    ANNUAL_QTY    NUMBER,

    YIELD         NUMBER,

    TOTAL_COST    NUMBER,

    OUT_PRICE_F   NUMBER,

    OUT_PRICE_RMB NUMBER,

    SALEMONEY     NUMBER,

    JGF_BATCH     NUMBER,

    JGF_PERQP     NUMBER,

    COST_PERQP    NUMBER,

    ML_PERQP      NUMBER,

    Y_JG_RE       NUMBER,

    Y_ML          NUMBER,

    Y_SALE        NUMBER,

    CUSTOMID      NUMBER,

    CUSTOMNAME    VARCHAR2(50),

    COUNTRY       VARCHAR2(20),

    PROJECTNO     VARCHAR2(20),

    USEFLAG       NUMBER DEFAULT 0,

    YIELD_TIME    DATE DEFAULT SYSDATE,

    APEX_PL_TIME  DATE DEFAULT SYSDATE,

    ZX_SOURCE     VARCHAR2(100),

    FMNAME        VARCHAR2(100) DEFAULT '人民币',

    FMRATE        NUMBER DEFAULT 1,

    GOODSNAME_EN  VARCHAR2(2000),

    LIVERY        VARCHAR2(100),

    DELETED       NUMBER(1)       DEFAULT 0,

    CREATE_TIME   TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME   TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY     VARCHAR2(64),

    UPDATE_BY     VARCHAR2(64),

    CONSTRAINT PK_COST_PINGGU PRIMARY KEY (DOCID)

);

CREATE SEQUENCE SEQ_COST_PINGGU START WITH 100000 INCREMENT BY 1;



CREATE TABLE T_COST_PINGGU_DTL (

    DOCID            NUMBER(10) NOT NULL,

    APEX_GOODSID     NUMBER(10),

    APEX_GOODSNAME   VARCHAR2(500),

    DTL_USEFLAG      VARCHAR2(100),

    SPEC             VARCHAR2(100),

    PER_HL           NUMBER,

    EXADD_MATER      NUMBER,

    BATCH_QTY        VARCHAR2(100),

    PRICE            NUMBER,

    COST_BATCH       NUMBER,

    MEMO             VARCHAR2(100),

    DTLID            NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY,

    APEX_FACTORYNAME VARCHAR2(200),

    APEX_FACTORYID   NUMBER(10),

    MODIFYDATE       DATE,

    ZX_SOURCE        VARCHAR2(100),

    BASE_PRICE       NUMBER,

    SUQTY            NUMBER,

    GOODSTYPE        VARCHAR2(4000),

    GOODSNAME_EN     VARCHAR2(2000),

    DELETED          NUMBER(1)       DEFAULT 0,

    CREATE_TIME      TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME      TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY        VARCHAR2(64),

    UPDATE_BY        VARCHAR2(64),

    CONSTRAINT PK_COST_PINGGU_DTL PRIMARY KEY (DTLID)

);



CREATE TABLE T_COST_MATERIAL (

    ID              NUMBER(19)      PRIMARY KEY,

    MATERIAL_CODE   VARCHAR2(32)    NOT NULL UNIQUE,

    MATERIAL_NAME   VARCHAR2(128)   NOT NULL,

    USE_FLAG        VARCHAR2(32)    NOT NULL,

    PER_HL          NUMBER(18,6)    DEFAULT 0,

    PRICE           NUMBER(18,4)    DEFAULT 0,

    UNIT            VARCHAR2(32),

    SPEC            VARCHAR2(64),

    DELETED         NUMBER(1)       DEFAULT 0,

    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,

    UPDATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CREATE_BY       VARCHAR2(64),

    UPDATE_BY       VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_MATERIAL START WITH 1 INCREMENT BY 1;



-- 外币管理

CREATE TABLE T_COST_FORMONEY

(

  FMID        NUMBER(10)   NOT NULL, -- 外币ID（主键）

  FMOPCODE    VARCHAR2(60),          -- 外币编码

  FMNAME      VARCHAR2(120),         -- 外币名称

  FMSIGN      VARCHAR2(60),          -- 外币符号

  FMUNIT      VARCHAR2(60),          -- 外币单位

  FMRATE      NUMBER(16,6),          -- 外币税率

  USESTATUS   NUMBER(2),             -- 使用状态

  DELETED     NUMBER(1) DEFAULT 0,

  CREATE_TIME TIMESTAMP DEFAULT SYSTIMESTAMP,

  UPDATE_TIME TIMESTAMP DEFAULT SYSTIMESTAMP,

  CREATE_BY   VARCHAR2(64),

  UPDATE_BY   VARCHAR2(64),

  CONSTRAINT PK_COST_FORMONEY PRIMARY KEY (FMID)

);

CREATE SEQUENCE SEQ_COST_FORMONEY START WITH 1 INCREMENT BY 1;



-- 部门管理

CREATE TABLE T_COST_DEPT (

    DEPTID       NUMBER(19) PRIMARY KEY,

    DEPTNAME     VARCHAR2(300),

    MANAGER      NUMBER,

    DELETED      NUMBER(1)   DEFAULT 0,

    CREATE_TIME  TIMESTAMP  DEFAULT SYSTIMESTAMP,

    UPDATE_TIME  TIMESTAMP  DEFAULT SYSTIMESTAMP,

    CREATE_BY    VARCHAR2(64),

    UPDATE_BY    VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_DEPT START WITH 1 INCREMENT BY 1;



-- 产品信息（每5分钟从 ERP 同步）

CREATE TABLE T_COST_GOODS (

    GOODSID        NUMBER(19) PRIMARY KEY,

    GOODSNAME      VARCHAR2(1000),

    PRICE          NUMBER,

    SUQTY          NUMBER,

    USEFLAG        VARCHAR2(100) DEFAULT '产成品',

    FACTORYNAME    VARCHAR2(1500),

    STANDARDTYPE   VARCHAR2(500),

    ZX_PL          NUMBER,

    ZX_MINIMUM     NUMBER,

    APPROVEDOCNO   VARCHAR2(500),

    BASEUNITQTY    NUMBER,

    ZX_CUSTOMERID  NUMBER(19),

    CUSTOMNAME     VARCHAR2(1000),

    TARGETMARKET   VARCHAR2(1000),

    HOLDERSNAME    VARCHAR2(1000),

    ISERP          NUMBER(1) DEFAULT 0,

    GOODSTYPE      VARCHAR2(500),

    PACKTYPE       VARCHAR2(500),

    TRANPOSNAME    VARCHAR2(1000),

    BOMID          NUMBER(19),

    LASTSUQTY      NUMBER,

    TRANPOSID      NUMBER(19),

    DELETED        NUMBER(1) DEFAULT 0,

    CREATE_TIME    TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_TIME    TIMESTAMP DEFAULT SYSTIMESTAMP,

    CREATE_BY      VARCHAR2(320),

    UPDATE_BY      VARCHAR2(320)

);

CREATE SEQUENCE SEQ_COST_GOODS START WITH 1 INCREMENT BY 1;



-- Product price

CREATE TABLE T_COST_GOODS_PRICE (

    GOODSID      NUMBER(10) PRIMARY KEY,

    GOODSNAME    VARCHAR2(300),

    PRICE        NUMBER,

    USEFLAG      VARCHAR2(15),

    GOODSTYPE    VARCHAR2(3000),

    PACKTYPE     VARCHAR2(600),

    FACTORYNAME  VARCHAR2(300),

    DELETED      NUMBER(1) DEFAULT 0,

    CREATE_TIME  TIMESTAMP DEFAULT SYSTIMESTAMP,

    UPDATE_TIME  TIMESTAMP DEFAULT SYSTIMESTAMP,

    CREATE_BY    VARCHAR2(64),

    UPDATE_BY    VARCHAR2(64),

    ISERP        NUMBER(1) DEFAULT 0

);

CREATE SEQUENCE SEQ_COST_GOODS_PRICE START WITH 1 INCREMENT BY 1;



-- 客户信息

CREATE TABLE T_COST_CUSTOMER (

    CUSTOMID    NUMBER(19) PRIMARY KEY,

    ZONE        VARCHAR2(500),

    CUSTOMNAME  VARCHAR2(500),

    DELETED     NUMBER(1)   DEFAULT 0,

    CREATE_TIME TIMESTAMP  DEFAULT SYSTIMESTAMP,

    UPDATE_TIME TIMESTAMP  DEFAULT SYSTIMESTAMP,

    CREATE_BY   VARCHAR2(64),

    UPDATE_BY   VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_CUSTOMER START WITH 1 INCREMENT BY 1;



-- 分销商信息

CREATE TABLE T_COST_TRANPOSER (

    TRANPOSID    NUMBER(19) PRIMARY KEY,

    CUSTOMID     NUMBER(19),

    TRANPOSNAME  VARCHAR2(500),

    DELETED      NUMBER(1)   DEFAULT 0,

    CREATE_TIME  TIMESTAMP  DEFAULT SYSTIMESTAMP,

    UPDATE_TIME  TIMESTAMP  DEFAULT SYSTIMESTAMP,

    CREATE_BY    VARCHAR2(64),

    UPDATE_BY    VARCHAR2(64)

);

CREATE SEQUENCE SEQ_COST_TRANPOSER START WITH 1 INCREMENT BY 1;



COMMIT;



-- A4. 日志模块表结构

CREATE TABLE T_COST_OPERATION_LOG (

    ID              NUMBER(19)      PRIMARY KEY,

    USER_ID         NUMBER(19),

    USER_NAME       VARCHAR2(64),

    OPERATION_TYPE  VARCHAR2(32)    NOT NULL,

    TABLE_CODE      VARCHAR2(64),

    RECORD_ID       NUMBER(19),

    RECORD_DESC     VARCHAR2(256),

    TOTAL_SQL_COUNT NUMBER(10)      DEFAULT 0,

    TOTAL_COST_MS   NUMBER(10)      DEFAULT 0,

    STATUS          VARCHAR2(16)    DEFAULT 'SUCCESS',

    ERROR_MSG       VARCHAR2(1000),

    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_OPERATION_LOG START WITH 1 INCREMENT BY 1;

CREATE INDEX IDX_OPERATION_LOG_USER ON T_COST_OPERATION_LOG(USER_ID);

CREATE INDEX IDX_OPERATION_LOG_TIME ON T_COST_OPERATION_LOG(CREATE_TIME);



CREATE TABLE T_COST_OPERATION_LOG_DETAIL (

    ID              NUMBER(19)      PRIMARY KEY,

    LOG_ID          NUMBER(19)      NOT NULL,

    SEQ_NO          NUMBER(5)       NOT NULL,

    SQL_TYPE        VARCHAR2(16),

    SQL_TEXT        CLOB,

    COST_MS         NUMBER(10)      DEFAULT 0,

    AFFECTED_ROWS   NUMBER(10),

    STATUS          VARCHAR2(16)    DEFAULT 'SUCCESS',

    ERROR_MSG       VARCHAR2(1000),

    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP,

    CONSTRAINT FK_LOG_DETAIL_LOG FOREIGN KEY (LOG_ID) REFERENCES T_COST_OPERATION_LOG(ID)

);

CREATE SEQUENCE SEQ_COST_OPERATION_LOG_DETAIL START WITH 1 INCREMENT BY 1;



CREATE TABLE T_COST_AUDIT_LOG (

    ID              NUMBER(19)      PRIMARY KEY,

    USER_NAME       VARCHAR2(100),

    OPERATION_TIME  TIMESTAMP       DEFAULT SYSTIMESTAMP,

    PAGE_CODE       VARCHAR2(100),

    TABLE_CODE      VARCHAR2(100),

    TABLE_NAME      VARCHAR2(200),

    RECORD_ID       NUMBER(19),

    OPERATION_TYPE  VARCHAR2(20),

    FIELD_CHANGES   CLOB,

    CREATE_TIME     TIMESTAMP       DEFAULT SYSTIMESTAMP

);

CREATE SEQUENCE SEQ_COST_AUDIT_LOG START WITH 1 INCREMENT BY 1;



COMMIT;



-- =====================================================

-- B. 视图定义

-- =====================================================



-- B1. 原辅料视图

CREATE OR REPLACE VIEW V_COST_PINGGU_MATERIAL AS

SELECT 

    d.DTLID AS ID,

    d.DOCID AS MASTER_ID,

    d.APEX_GOODSID,

    d.APEX_GOODSNAME,

    d.DTL_USEFLAG,

    d.SPEC,

    d.PER_HL,

    d.PRICE,

    d.BATCH_QTY,

    d.COST_BATCH,

    d.APEX_FACTORYNAME,

    d.ZX_SOURCE,

    d.BASE_PRICE,

    d.GOODSTYPE,

    d.EXADD_MATER,

    d.MEMO,

    d.DELETED,

    d.CREATE_TIME,

    d.UPDATE_TIME,

    d.CREATE_BY,

    d.UPDATE_BY,

    CASE

        WHEN d.DTL_USEFLAG = '辅料' AND REGEXP_LIKE(d.APEX_GOODSNAME, '胶囊') THEN 'B'

        WHEN d.DTL_USEFLAG IN ('原料', '辅料') THEN 'C'

        ELSE NULL

    END AS FORMULA_TYPE

FROM T_COST_PINGGU_DTL d

WHERE d.DTL_USEFLAG IN ('原料', '辅料')

  AND (d.DELETED = 0 OR d.DELETED IS NULL);



-- B2. 包材视图：严格按存储过程分支

CREATE OR REPLACE VIEW V_COST_PINGGU_PACKAGE AS

SELECT 

    d.DTLID AS ID,

    d.DOCID AS MASTER_ID,

    d.APEX_GOODSID,

    d.APEX_GOODSNAME,

    d.DTL_USEFLAG,

    d.SPEC,

    d.PER_HL,

    d.EXADD_MATER,

    d.PRICE,

    d.BATCH_QTY,

    d.COST_BATCH,

    d.SUQTY,

    d.APEX_FACTORYNAME,

    d.ZX_SOURCE,

    d.MEMO,

    d.DELETED,

    d.CREATE_TIME,

    d.UPDATE_TIME,

    d.CREATE_BY,

    d.UPDATE_BY,

    CASE

        WHEN REGEXP_LIKE(d.APEX_GOODSNAME, '桶|说明书|小盒|标签|瓶|盖') THEN 'A'

        WHEN REGEXP_LIKE(d.APEX_GOODSNAME, '硬片|铝箔|复合膜') THEN 'D'

        WHEN REGEXP_LIKE(d.APEX_GOODSNAME, '大纸箱') THEN 'E'

        WHEN REGEXP_LIKE(d.APEX_GOODSNAME, '托盘') THEN 'F'

        ELSE NULL

    END AS FORMULA_TYPE

FROM T_COST_PINGGU_DTL d

WHERE d.DTL_USEFLAG IN ('非印字包材', '印字包材')

  AND (d.DELETED = 0 OR d.DELETED IS NULL);



-- B3. 用户角色视图

CREATE OR REPLACE VIEW V_COST_USER_ROLE AS

SELECT 

    ur.ID,

    ur.USER_ID,

    ur.ROLE_ID,

    u.USERNAME,

    u.REAL_NAME,

    r.ROLE_CODE,

    r.ROLE_NAME,

    ur.DELETED,

    ur.CREATE_BY,

    ur.CREATE_TIME

FROM T_COST_USER_ROLE ur

JOIN T_COST_USER u ON ur.USER_ID = u.ID

JOIN T_COST_ROLE r ON ur.ROLE_ID = r.ID

WHERE ur.DELETED = 0;



-- B4. 外币管理视图

CREATE OR REPLACE VIEW ERP_FORMONEY_V AS

SELECT 

       DECODE(b.fmid,     NULL, a.fmid,     b.fmid)     fmid,

       DECODE(b.fmopcode, NULL, a.fmopcode, b.fmopcode) fmopcode,

       DECODE(b.fmname,   NULL, a.fmname,   b.fmname)   fmname,

       DECODE(b.fmsign,   NULL, a.fmsign,   b.fmsign)   fmsign,

       DECODE(b.fmunit,   NULL, a.fmunit,   b.fmunit)   fmunit,

       DECODE(b.fmrate,   NULL, a.fmrate,   b.fmrate)   fmrate,

       DECODE(b.usestatus,NULL, a.usestatus,b.usestatus) usestatus,

       NVL(b.deleted, 0)  deleted,

       b.create_time,

       b.update_time,

       b.create_by,

       b.update_by

  FROM pub_formoney_v@hyerp a, T_COST_FORMONEY b

 WHERE a.fmid = b.fmid(+);



-- B5. 产品信息同步存储过程（每5分钟执行）

CREATE OR REPLACE PROCEDURE SP_SYNC_COST_GOODS AS

BEGIN

    -- 使用 MERGE 实现增量同步

    MERGE INTO T_COST_GOODS T

    USING (

        SELECT B.GOODSID,

               B.GOODSNAME,

               C.LASTPRICE AS PRICE,

               C.LASTSUQTY AS SUQTY,

               (CASE

                 WHEN B.ZX_WMS_GOODSCLASS IN (1, 12) AND B.GSPFLAG = 1 AND B.GOODSNO LIKE '%A%' THEN '原料'

                 WHEN B.ZX_WMS_GOODSCLASS IN (10) AND B.GSPFLAG = 1 THEN '产成品'

                 WHEN B.ZX_WMS_GOODSCLASS IN (7, 8, 9) AND B.GSPFLAG = 1 THEN '半成品'

                 WHEN B.ZX_WMS_GOODSCLASS IN (5, 13) AND B.GSPFLAG = 1 THEN '非印字包材'

                 WHEN B.ZX_WMS_GOODSCLASS IN (6) AND B.GSPFLAG = 1 THEN '印字包材'

                 WHEN B.ZX_WMS_GOODSCLASS IN (1, 2, 3, 4) AND B.GSPFLAG = 1 AND B.GOODSNO NOT LIKE '%A%' THEN '辅料'

               END) AS USEFLAG,

               B.FACTORYNAME,

               B.STANDARDTYPE,

               B.ZX_PL,

               B.ZX_MINIMUM,

               B.APPROVEDOCNO,

               E.BASEUNITQTY,

               B.ZX_CUSTOMERID,

               B.CUSTOMNAME,

               F.TARGETMARKET,

               B.HOLDERSNAME,

               B.GOODSTYPE,

               B.PACKTYPE,

               B.TRANPOSNAME,

               D.BOMID,

               C.LASTSUQTY AS LASTSUQTY2,

               B.TRANPOSID

          FROM PUB_GOODS_V@hyerp B,

               BMS_SU_SUPPLYGOODS_DOC@hyerp C,

               MPCS_PR_BOM_DOC@hyerp D,

               PUB_GOODS_UNIT_V@hyerp E,

               BMS_TR_POS_DEF@hyerp F

         WHERE B.GOODSID = C.GOODSID(+)

           AND B.GOODSID = D.PGOODSID(+)

           AND D.USESTATUS(+) = 1

           AND B.USESTATUS = 1

           AND C.ENTRYID(+) = 1

           AND B.GOODSID = E.GOODSID(+)

           AND E.GOODSDTLFLAG(+) = 1

           AND E.BASEFLAG(+) <> 1

           AND B.GOODSID < 1000000

           AND B.ZX_CUSTOMERID = F.COMPANYID(+)

           AND B.TRANPOSID = F.TRANPOSID(+)

    ) S

    ON (T.GOODSID = S.GOODSID)

    WHEN MATCHED THEN

        UPDATE SET

            T.GOODSNAME = S.GOODSNAME,

            T.PRICE = S.PRICE,

            T.SUQTY = S.SUQTY,

            T.USEFLAG = S.USEFLAG,

            T.FACTORYNAME = S.FACTORYNAME,

            T.STANDARDTYPE = S.STANDARDTYPE,

            T.ZX_PL = S.ZX_PL,

            T.ZX_MINIMUM = S.ZX_MINIMUM,

            T.APPROVEDOCNO = S.APPROVEDOCNO,

            T.BASEUNITQTY = S.BASEUNITQTY,

            T.ZX_CUSTOMERID = S.ZX_CUSTOMERID,

            T.CUSTOMNAME = S.CUSTOMNAME,

            T.TARGETMARKET = S.TARGETMARKET,

            T.HOLDERSNAME = S.HOLDERSNAME,

            T.GOODSTYPE = S.GOODSTYPE,

            T.PACKTYPE = S.PACKTYPE,

            T.TRANPOSNAME = S.TRANPOSNAME,

            T.BOMID = S.BOMID,

            T.LASTSUQTY = S.LASTSUQTY2,

            T.TRANPOSID = S.TRANPOSID,

            T.ISERP = 1,

            T.UPDATE_TIME = SYSTIMESTAMP,

            T.UPDATE_BY = 'ERP_SYNC'

    WHEN NOT MATCHED THEN

        INSERT (GOODSID, GOODSNAME, PRICE, SUQTY, USEFLAG, FACTORYNAME, STANDARDTYPE,

                ZX_PL, ZX_MINIMUM, APPROVEDOCNO, BASEUNITQTY, ZX_CUSTOMERID, CUSTOMNAME,

                TARGETMARKET, HOLDERSNAME, ISERP, GOODSTYPE, PACKTYPE, TRANPOSNAME,

                BOMID, LASTSUQTY, TRANPOSID, DELETED, CREATE_TIME, UPDATE_TIME, CREATE_BY, UPDATE_BY)

        VALUES (S.GOODSID, S.GOODSNAME, S.PRICE, S.SUQTY, S.USEFLAG, S.FACTORYNAME, S.STANDARDTYPE,

                S.ZX_PL, S.ZX_MINIMUM, S.APPROVEDOCNO, S.BASEUNITQTY, S.ZX_CUSTOMERID, S.CUSTOMNAME,

                S.TARGETMARKET, S.HOLDERSNAME, 1, S.GOODSTYPE, S.PACKTYPE, S.TRANPOSNAME,

                S.BOMID, S.LASTSUQTY2, S.TRANPOSID, 0, SYSTIMESTAMP, SYSTIMESTAMP, 'ERP_SYNC', 'ERP_SYNC');

    COMMIT;

END;

/



-- 创建定时任务：每5分钟同步产品信息

BEGIN

    DBMS_SCHEDULER.CREATE_JOB (

        job_name        => 'JOB_SYNC_COST_GOODS',

        job_type        => 'PLSQL_BLOCK',

        job_action      => 'BEGIN SP_SYNC_COST_GOODS; END;',

        start_date      => SYSTIMESTAMP,

        repeat_interval => 'FREQ=MINUTELY; INTERVAL=5',

        enabled         => TRUE,

        comments        => '每5分钟从 ERP 同步产品信息'

    );

EXCEPTION

    WHEN OTHERS THEN

        IF SQLCODE = -27477 THEN NULL; END IF; -- 忽略已存在的任务

END;

/



-- B6. 产品信息视图（只显示产成品）

CREATE OR REPLACE VIEW T_COST_GOODS_V AS

SELECT GOODSID,

       GOODSNAME,

       PRICE,

       SUQTY,

       USEFLAG,

       FACTORYNAME,

       STANDARDTYPE,

       ZX_PL,

       ZX_MINIMUM,

       APPROVEDOCNO,

       BASEUNITQTY,

       ZX_CUSTOMERID,

       CUSTOMNAME,

       TARGETMARKET,

       HOLDERSNAME,

       ISERP,

       GOODSTYPE,

       PACKTYPE,

       TRANPOSNAME,

       BOMID,

       LASTSUQTY,

       TRANPOSID,

       DELETED,

       CREATE_TIME,

       UPDATE_TIME,

       CREATE_BY,

       UPDATE_BY

  FROM T_COST_GOODS

 WHERE USEFLAG = '产成品'

   AND (DELETED = 0 OR DELETED IS NULL);



-- B7. 产品价格视图

CREATE OR REPLACE VIEW T_COST_GOODS_PRICE_V AS

SELECT GOODSID,

       GOODSNAME,

       PRICE,

       USEFLAG,

       GOODSTYPE,

       PACKTYPE,

       FACTORYNAME,

       DELETED,

       CREATE_TIME,

       UPDATE_TIME,

       CREATE_BY,

       UPDATE_BY,

       ISERP,

       CASE

           WHEN ISERP = 1

            AND NVL(LOWER(UPDATE_BY), '#') <> 'system'

            AND PRICE IS NULL THEN 'erp-price-null'

           WHEN ISERP = 1

            AND NVL(LOWER(UPDATE_BY), '#') <> 'system' THEN 'erp-updated'

           WHEN ISERP = 1 THEN 'erp'

           ELSE NULL

       END AS ROW_CLASS_FLAG

  FROM T_COST_GOODS_PRICE;



-- B7. 客户/分销商视图

CREATE OR REPLACE VIEW T_COST_CUSTOMER_V AS

SELECT CUSTOMID,

       CUSTOMNAME,

       ZONE,

       1 AS ISERP,

       0 AS DELETED,

       NULL AS CREATE_TIME,

       NULL AS UPDATE_TIME,

       NULL AS CREATE_BY,

       NULL AS UPDATE_BY

  FROM PUB_CUSTOMER@hyerp

UNION ALL

SELECT CUSTOMID,

       CUSTOMNAME,

       ZONE,

       0 AS ISERP,

       DELETED,

       CREATE_TIME,

       UPDATE_TIME,

       CREATE_BY,

       UPDATE_BY

  FROM T_COST_CUSTOMER

  where DELETED=0 ;



CREATE OR REPLACE VIEW T_COST_TRANPOSER_V AS

SELECT CUSTOMID,

       TRANPOSID,

       TRANPOSNAME,

       0 AS ISERP,

       DELETED,

       CREATE_TIME,

       UPDATE_TIME,

       CREATE_BY,

       UPDATE_BY

  FROM T_COST_TRANPOSER where DELETED=0

UNION ALL

SELECT COMPANYID,

       TRANPOSID,

       TRANPOSNAME,

       1 AS ISERP,

       0 AS DELETED,

       NULL AS CREATE_TIME,

       NULL AS UPDATE_TIME,

       NULL AS CREATE_BY,

       NULL AS UPDATE_BY

  FROM BMS_TR_POS_DEF@hyerp;



-- B7. 客户 + 分销商回填视图（产品信息用）

CREATE OR REPLACE VIEW T_COST_CUST_TRANPOSER_REL_V AS

SELECT a.customname,

       a.zone,

       b.tranposname,

       a.customid,

       b.tranposid,

       0 deleted

  FROM pub_customer@hyerp a, bms_tr_pos_def@hyerp b

 WHERE a.customid = b.companyid

   AND a.zone IS NOT NULL

UNION ALL

SELECT a.customname,

       a.zone,

       b.tranposname,

       a.customid,

       b.tranposid,

       a.deleted

  FROM (select * from t_cost_customer where deleted=0) a, (select * from t_cost_tranposer where deleted=0) b

WHERE a.customid = b.customid;


-- B8. 装箱发运单视图

CREATE OR REPLACE VIEW T_WMS_CON_DOC_V AS
SELECT a.conid,
       a.conno,
       a.customname,
       a.targetposname,
       a.inputmanname,
       0 AS DELETED,
       NULL AS CREATE_TIME,
       NULL AS UPDATE_TIME,
       NULL AS CREATE_BY,
       NULL AS UPDATE_BY
  FROM bms_sa_con_doc_v@hyerp a;


-- B9. 装箱发运数量汇总视图

CREATE OR REPLACE VIEW T_WMS_QTY_V AS
SELECT
    NVL(TO_CHAR(a.conid), '-') || '-' || NVL(TO_CHAR(a.goodsid), '-') || '-' || NVL(a.lotno, '-') || '-' || NVL(TO_CHAR(a.packtype), '-') AS ID,
    a.conid,
    a.goodsid,
    a.goodsno,
    a.goodsname,
    a.lotno,
    a.packtype,
    b.goodsqty_total,
    b.goodsqty_oddtray1,
    b.packname,

    /* 最终显示字段 */
    TO_CHAR(NVL(b.goodsqty_total, 0)) || b.packname
    || '（'
    || CASE
         WHEN NVL(b.goodsqty_oddtray1, 0) > 0
         THEN '含零头' || TO_CHAR(b.goodsqty_oddtray1) || b.packname || '，'
       END
    || '样品__' || b.packname
    || '）' AS QTY_SHOW,
    0 AS DELETED,
    NULL AS CREATE_TIME,
    NULL AS UPDATE_TIME,
    NULL AS CREATE_BY,
    NULL AS UPDATE_BY

FROM bms_sa_con_dtl_v@hyerp a,
     (
       SELECT
           x.goodsownid,
           x.lotno,
           x.packname,
           SUM(x.goodsqty) AS goodsqty_total,
           SUM(CASE WHEN x.oddtray = 1 THEN x.goodsqty ELSE 0 END) AS goodsqty_oddtray1
       FROM wms_st_qty_lst_baseunit_v@to_wms x
       GROUP BY x.goodsownid, x.lotno, x.packname
     ) b
WHERE a.goodsid = b.goodsownid(+)
  AND a.lotno   = b.lotno(+);


-- B10. 装箱发运数量明细视图

CREATE OR REPLACE VIEW T_WMS_QTY_DTL_V AS
SELECT
    NVL(TO_CHAR(a.conid), '-') || '-' || NVL(TO_CHAR(a.goodsid), '-') || '-' || NVL(a.lotno, '-') || '-' || NVL(TO_CHAR(b.packsize), '-') AS ID,
    NVL(b.goodsownid, a.goodsid) AS GOODSOWNID,
    b.goodsname,
    NVL(b.lotno, a.lotno) AS LOTNO,
    b.goodsqty,
    b.packsize,
    CEIL(b.goodsqty / NULLIF(b.packsize, 0)) AS QTY_BOX,
    b.validdate,
    NULL AS MEMO,
    NULL AS GROSS_WEIGHT_KG,
    NULL AS NET_WEIGHT_KG,
    NULL AS VOLUME_M2,
    a.conid,
    0 AS DELETED,
    NULL AS CREATE_TIME,
    NULL AS UPDATE_TIME,
    NULL AS CREATE_BY,
    NULL AS UPDATE_BY
FROM bms_sa_con_dtl_v@hyerp a, wms_st_qty_lst_baseunit_v@to_wms b
WHERE a.goodsid = b.goodsownid(+)
  AND a.lotno   = b.lotno(+);





COMMIT;





-- =====================================================

-- C. 初始化数据

-- =====================================================



-- C1. 部门/角色/用户

INSERT INTO T_COST_DEPARTMENT (ID, DEPT_CODE, DEPT_NAME, PARENT_ID, SORT_ORDER, CREATE_BY)

VALUES (SEQ_COST_DEPARTMENT.NEXTVAL, 'ROOT', '总公司', NULL, 0, 'system');

INSERT INTO T_COST_DEPARTMENT (ID, DEPT_CODE, DEPT_NAME, PARENT_ID, SORT_ORDER, CREATE_BY)

VALUES (SEQ_COST_DEPARTMENT.NEXTVAL, 'FINANCE', '财务部', 1, 1, 'system');



INSERT INTO T_COST_ROLE (ID, ROLE_CODE, ROLE_NAME, DESCRIPTION, CREATE_BY)

VALUES (SEQ_COST_ROLE.NEXTVAL, 'ADMIN', '系统管理员', '拥有所有权限', 'system');

INSERT INTO T_COST_ROLE (ID, ROLE_CODE, ROLE_NAME, DESCRIPTION, CREATE_BY)

VALUES (SEQ_COST_ROLE.NEXTVAL, 'FINANCE_MANAGER', '财务经理', '财务部门管理权限', 'system');

INSERT INTO T_COST_ROLE (ID, ROLE_CODE, ROLE_NAME, DESCRIPTION, CREATE_BY)

VALUES (SEQ_COST_ROLE.NEXTVAL, 'FINANCE_STAFF', '财务专员', '财务部门普通权限', 'system');



-- 默认用户，密码 123456（BCrypt 已加密）

INSERT INTO T_COST_USER (ID, USERNAME, PASSWORD, REAL_NAME, DEPARTMENT_ID, CREATE_BY)

VALUES (SEQ_COST_USER.NEXTVAL, 'admin', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKt6Z5EH', '系统管理员', 1, 'system');

INSERT INTO T_COST_USER (ID, USERNAME, PASSWORD, REAL_NAME, DEPARTMENT_ID, CREATE_BY)

VALUES (SEQ_COST_USER.NEXTVAL, 'zhangsan', '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKt6Z5EH', '张三', 2, 'system');



INSERT INTO T_COST_USER_ROLE (ID, USER_ID, ROLE_ID, CREATE_BY) VALUES (SEQ_COST_USER_ROLE.NEXTVAL, 1, 1, 'system');

INSERT INTO T_COST_USER_ROLE (ID, USER_ID, ROLE_ID, CREATE_BY) VALUES (SEQ_COST_USER_ROLE.NEXTVAL, 2, 2, 'system');



COMMIT;



-- C2. 菜单资源

INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'home', '首页', 'PAGE', 'home', 'mdi:monitor-dashboard', '/home', NULL, 0, 'system');



INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'cost', '成本管理', 'DIRECTORY', NULL, 'mdi:currency-usd', '/cost', NULL, 1, 'system');



INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'system', '系统管理', 'DIRECTORY', NULL, 'mdi:cog', '/system', NULL, 99, 'system');



DECLARE

    v_cost_id NUMBER;

    v_system_id NUMBER;

BEGIN

    SELECT ID INTO v_cost_id FROM T_COST_RESOURCE WHERE RESOURCE_CODE = 'cost';

    SELECT ID INTO v_system_id FROM T_COST_RESOURCE WHERE RESOURCE_CODE = 'system';

    

    -- 成本评估V2

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'cost-pinggu-v2', '成本评估', 'PAGE', 'cost-pinggu-v2', 'mdi:calculator-variant', '/cost/cost-pinggu-v2', v_cost_id, 1, 'system');



    -- 成本管理 - 外币管理

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'formoney', '外币管理', 'PAGE', 'formoney-manage', 'mdi:currency-usd', '/cost/formoney', v_cost_id, 10, 'system');



    -- 成本管理 - 产品信息

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'goods', '产品信息', 'PAGE', 'goods-manage', 'mdi:package-variant', '/cost/goods', v_cost_id, 2, 'system');



    -- 成本管理 - 产品价格

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'goods-price', '产品价格', 'PAGE', 'goods-price-manage', 'mdi:tag-outline', '/cost/goods-price', v_cost_id, 4, 'system');



    -- 成本管理 - 客户信息

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'customer', '客户信息', 'PAGE', 'customer-manage', 'mdi:account-box', '/cost/customer', v_cost_id, 3, 'system');


    -- 成本管理 - 装箱发运单

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'wms-con-doc', '装箱发运单', 'PAGE', 'wms-con-doc', 'mdi:truck', '/cost/wms-con-doc', v_cost_id, 5, 'system');

    

    -- 系统管理 - 人员管理

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'user', '人员管理', 'PAGE', 'user-manage', 'mdi:account-group', '/system/user', v_system_id, 1, 'system');

    

    -- 系统管理 - 角色管理

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'role', '角色管理', 'PAGE', 'role-manage', 'mdi:shield-account', '/system/role', v_system_id, 2, 'system');



    -- 系统管理 - 部门管理

    INSERT INTO T_COST_RESOURCE (ID, RESOURCE_CODE, RESOURCE_NAME, RESOURCE_TYPE, PAGE_CODE, ICON, ROUTE, PARENT_ID, SORT_ORDER, CREATE_BY)

    VALUES (SEQ_COST_RESOURCE.NEXTVAL, 'dept', '部门管理', 'PAGE', 'dept-manage', 'mdi:domain', '/system/dept', v_system_id, 3, 'system');

END;

/



COMMIT;



-- =====================================================

-- D. 元数据配置

-- =====================================================



-- D1. 主表元数据 (CostPinggu)

DECLARE

    v_master_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_master_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES (v_master_id, 'CostPinggu', '成本评估', 'T_COST_PINGGU', 'T_COST_PINGGU', 'SEQ_COST_PINGGU', 'DOCID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'id', 'DOCID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'goodsname', 'GOODSNAME', '产品名称', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'goodsnameEn', 'GOODSNAME_EN', '产品英文名', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'strength', 'STRENGTH', '剂量', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'customname', 'CUSTOMNAME', '客户名称', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'country', 'COUNTRY', '国家', 'text', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'projectno', 'PROJECTNO', '项目号', 'text', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'apexPl', 'APEX_PL', '批量', 'number', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'annualQty', 'ANNUAL_QTY', '年需求量', 'number', 8, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'yield', 'YIELD', '收率(%)', 'number', 9, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'pPerpack', 'P_PERPACK', '每盒片数', 'number', 10, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'sPerback', 'S_PERBACK', '每箱装盒数', 'number', 11, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'xPerback', 'X_PERBACK', '每托盘箱数', 'number', 12, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'packtype', 'PACKTYPE', '包装形式', 'text', 13, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalYl', 'TOTAL_YL', '原料合计', 'number', 20, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalFl', 'TOTAL_FL', '辅料合计', 'number', 21, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalBc', 'TOTAL_BC', '包材合计', 'number', 22, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'totalCost', 'TOTAL_COST', '总物料成本', 'number', 23, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'outPriceRmb', 'OUT_PRICE_RMB', '出厂价(RMB)', 'number', 24, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'salemoney', 'SALEMONEY', '每批销售额', 'number', 25, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'jgfBatch', 'JGF_BATCH', '每批加工费', 'number', 26, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'costPerqp', 'COST_PERQP', '千片成本', 'number', 27, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'jgfPerqp', 'JGF_PERQP', '千片加工费', 'number', 28, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'mlPerqp', 'ML_PERQP', '千片毛利', 'number', 29, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'yJgRe', 'Y_JG_RE', '年加工费', 'number', 30, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'yMl', 'Y_ML', '年毛利', 'number', 31, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_master_id, 'ySale', 'Y_SALE', '年销售额', 'number', 32, 'system');

    COMMIT;

END;

/





-- D2. 原辅料从表元数据 (CostMaterial)

DECLARE

    v_material_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_material_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES (v_material_id, 'CostMaterial', '原辅料明细', 'V_COST_PINGGU_MATERIAL', 'T_COST_PINGGU_DTL', 'DTLID', 'CostPinggu', 'DOCID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'masterId', 'MASTER_ID', '主表ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'dtlUseflag', 'DTL_USEFLAG', '分类', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'apexGoodsname', 'APEX_GOODSNAME', '物料名称', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'spec', 'SPEC', '规格', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'perHl', 'PER_HL', '每片含量', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'exaddMater', 'EXADD_MATER', '额外投料量', 'number', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'price', 'PRICE', '单价', 'number', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'batchQty', 'BATCH_QTY', '每批数量', 'number', 8, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'costBatch', 'COST_BATCH', '每批成本', 'number', 9, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'apexFactoryname', 'APEX_FACTORYNAME', '供应商', 'text', 10, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, IS_VIRTUAL, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_material_id, 'formulaType', 'FORMULA_TYPE', '公式类型', 'text', 11, 1, 'system');

    COMMIT;

END;

/



-- D3. 包材从表元数据 (CostPackage)

DECLARE

    v_package_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_package_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES (v_package_id, 'CostPackage', '包材明细', 'V_COST_PINGGU_PACKAGE', 'T_COST_PINGGU_DTL', 'DTLID', 'CostPinggu', 'DOCID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'masterId', 'MASTER_ID', '主表ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'dtlUseflag', 'DTL_USEFLAG', '包材类型', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'apexGoodsname', 'APEX_GOODSNAME', '包材名称', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'spec', 'SPEC', '规格型号', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'suqty', 'SUQTY', '用量', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'price', 'PRICE', '包材单价', 'number', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'batchQty', 'BATCH_QTY', '每批数量', 'number', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'costBatch', 'COST_BATCH', '包材成本', 'number', 8, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'apexFactoryname', 'APEX_FACTORYNAME', '包材供应商', 'text', 9, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, IS_VIRTUAL, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_package_id, 'formulaType', 'FORMULA_TYPE', '公式类型', 'text', 10, 1, 'system');

    COMMIT;

END;

/



-- D4. 页面规则配置 (cost-pinggu-v2)

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":false,"editable":false},

  {"field":"goodsname","width":null,"editable":true,"searchable":true},

  {"field":"goodsnameEn","width":null,"editable":true},

  {"field":"strength","width":null,"editable":true},

  {"field":"customname","width":null,"editable":true,"searchable":true},

  {"field":"country","width":null,"editable":true},

  {"field":"projectno","width":null,"editable":true},

  {"field":"apexPl","width":null,"editable":true},

  {"field":"annualQty","width":null,"editable":true},

  {"field":"yield","width":null,"editable":true},

  {"field":"pPerpack","width":null,"editable":true},

  {"field":"sPerback","width":null,"editable":true},

  {"field":"xPerback","width":null,"editable":true},

  {"field":"packtype","width":null,"editable":true},

  {"field":"totalYl","width":null,"editable":false},

  {"field":"totalFl","width":null,"editable":false},

  {"field":"totalBc","width":null,"editable":false},

  {"field":"totalCost","width":null,"editable":false},

  {"field":"outPriceRmb","width":null,"editable":true},

  {"field":"salemoney","width":null,"editable":false},

  {"field":"jgfBatch","width":null,"editable":false},

  {"field":"costPerqp","width":null,"editable":true},

  {"field":"jgfPerqp","width":null,"editable":false},

  {"field":"mlPerqp","width":null,"editable":false},

  {"field":"yJgRe","width":null,"editable":false},

  {"field":"yMl","width":null,"editable":false},

  {"field":"ySale","width":null,"editable":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'CALC',

'[

  {"field":"salemoney","expression":"outPriceRmb / pPerpack * apexPl * (yield / 100)","triggerFields":["outPriceRmb","pPerpack","apexPl","yield","totalCost"]},

  {"field":"jgfBatch","expression":"salemoney - totalCost","triggerFields":["salemoney","totalCost"]},

  {"field":"jgfPerqp","expression":"jgfBatch / apexPl * 1000","triggerFields":["jgfBatch","apexPl"]},

  {"field":"mlPerqp","expression":"jgfPerqp - costPerqp","triggerFields":["jgfPerqp","costPerqp"]},

  {"field":"yJgRe","expression":"jgfPerqp / 1000 * annualQty","triggerFields":["jgfPerqp","annualQty"]},

  {"field":"yMl","expression":"mlPerqp / 1000 * annualQty","triggerFields":["mlPerqp","annualQty"]},

  {"field":"ySale","expression":"salemoney / apexPl * annualQty","triggerFields":["salemoney","apexPl","annualQty"]}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'VALIDATION',

'[]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'AGGREGATE',

'[

  {"sourceField":"costBatch","targetField":"totalYl","algorithm":"SUM","sourceTab":"material","filter":"dtlUseflag === ''原料''"},

  {"sourceField":"costBatch","targetField":"totalFl","algorithm":"SUM","sourceTab":"material","filter":"dtlUseflag === ''辅料''"},

  {"sourceField":"costBatch","targetField":"totalBc","algorithm":"SUM","sourceTab":"package"},

  {"targetField":"totalCost","expression":"totalYl + totalFl + totalBc"}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":false,"editable":false},

  {"field":"masterId","visible":false,"editable":false},

  {"field":"dtlUseflag","width":null,"editable":false},

  {"field":"apexGoodsname","width":null,"editable":true},

  {"field":"spec","width":null,"editable":true},

  {"field":"perHl","width":null,"editable":true},

  {"field":"exaddMater","width":null,"editable":true},

  {"field":"price","width":null,"editable":true},

  {"field":"batchQty","width":null,"editable":false},

  {"field":"costBatch","width":null,"editable":false},

  {"field":"apexFactoryname","width":null,"editable":true},

  {"field":"formulaType","visible":false,"editable":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'CALC',

'[

  {"field":"batchQty","formulaField":"formulaType","formulas":{"C":{"expression":"perHl * apexPl * (1 + exaddMater / 100) / 1000000","triggerFields":["perHl","apexPl","exaddMater"]},"D":{"expression":"perHl * apexPl * (1 + exaddMater / 100) / 1000000","triggerFields":["perHl","apexPl","exaddMater"]}}},

  {"field":"costBatch","expression":"batchQty * price","triggerFields":["batchQty","price"]}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'VALIDATION',

'[

  {"field":"perHl","required":true,"min":0.001,"message":"每片含量必填且必须大于0"},

  {"field":"price","required":true,"min":0,"message":"单价必填且不能为负数"}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'LOOKUP',

'[

  {"field":"apexGoodsname","lookupCode":"material","mapping":{"apexGoodsname":"materialName","spec":"spec","price":"price"}}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":true,"editable":false},

  {"field":"masterId","visible":false,"editable":false},

  {"field":"dtlUseflag","width":null,"editable":false},

  {"field":"apexGoodsname","width":null,"editable":true},

  {"field":"spec","width":null,"editable":true},

  {"field":"suqty","width":null,"editable":true},

  {"field":"price","width":null,"editable":true},

  {"field":"batchQty","width":null,"editable":false},

  {"field":"costBatch","width":null,"editable":false},

  {"field":"apexFactoryname","width":null,"editable":true},

  {"field":"formulaType","visible":false,"editable":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'CALC',

'[

  {"field":"batchQty","formulaField":"formulaType","formulas":{"A":{"expression":"apexPl / pPerpack","triggerFields":["apexPl","pPerpack"]},"E":{"expression":"ceil(apexPl / (pPerpack * sPerback))","triggerFields":["apexPl","pPerpack","sPerback"]},"F":{"expression":"ceil(apexPl / (pPerpack * sPerback * xPerback))","triggerFields":["apexPl","pPerpack","sPerback","xPerback"]}}},

  {"field":"costBatch","expression":"batchQty * price","triggerFields":["batchQty","price"]}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'VALIDATION',

'[

  {"field":"price","min":0,"message":"包材单价不能为负数"}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'LOOKUP',

'[

  {"field":"apexGoodsname","lookupCode":"package","mapping":{"apexGoodsname":"materialName","spec":"spec","price":"price"}}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'ROLE_BINDING',

'{"role":"MASTER_GRID"}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'GRID_OPTIONS',

'{"cellSelection":true}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'ROLE_BINDING',

'{"role":"DETAIL_TABS"}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'RELATION',

'{"masterKey":"masterGrid","detailKey":"detailTabs"}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'BROADCAST',

'["apexPl","pPerpack","sPerback","xPerback"]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'SUMMARY_CONFIG',

'{"enabled":true,"groupLabelField":"groupLabel","groupLabelHeader":"分类","summaryColumns":[{"field":"totalAmount","headerName":"汇总金额","width":null},{"field":"rowCount","headerName":"行数","width":null}],"summaryAggregates":[{"sourceField":"costBatch","targetField":"totalAmount","algorithm":"SUM"},{"sourceField":"costBatch","targetField":"rowCount","algorithm":"COUNT"}]}', 'system');

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"label":"\u5bfc\u51fa","items":[{"action":"exportSelected","requiresSelection":true},{"action":"exportCurrent"},{"action":"exportAll"},{"type":"separator"},{"action":"resetExportConfig"},{"action":"openHeaderConfig"}]},{"type":"separator"},{"action":"save"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'user-manage', 'grid', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"label":"\u5bfc\u51fa","items":[{"action":"exportSelected","requiresSelection":true},{"action":"exportCurrent"},{"action":"exportAll"},{"type":"separator"},{"action":"resetExportConfig"},{"action":"openHeaderConfig"}]},{"type":"separator"},{"action":"save"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'role-manage', 'grid', 'CONTEXT_MENU',

'{"items":[{"action":"addRow"},{"action":"copyRow","requiresRow":true},{"action":"deleteRow","requiresRow":true},{"type":"separator"},{"action":"saveGridConfig"},{"type":"separator"},{"label":"\u5bfc\u51fa","items":[{"action":"exportSelected","requiresSelection":true},{"action":"exportCurrent"},{"action":"exportAll"},{"type":"separator"},{"action":"resetExportConfig"},{"action":"openHeaderConfig"}]},{"type":"separator"},{"action":"save"},{"type":"separator"},{"action":"clipboard.copy"},{"action":"clipboard.paste"}]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'user-manage', 'grid', 'LOOKUP',

'[

  {"field":"departmentId","lookupCode":"dept","mapping":{"departmentId":"id"}}

]', 'system');



-- 外币管理规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'formoney-manage', 'grid', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":false,"editable":false},

  {"field":"fmopcode","width":null,"editable":true,"searchable":true},

  {"field":"fmname","width":null,"editable":true,"searchable":true},

  {"field":"fmsign","width":null,"editable":true},

  {"field":"fmunit","width":null,"editable":true},

  {"field":"fmrate","width":null,"editable":true},

  {"field":"usestatus","width":null,"editable":true}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'formoney-manage', 'grid', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



-- 部门管理规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'dept-manage', 'grid', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



-- 产品信息规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-manage', 'grid', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":false,"editable":false},

  {"field":"goodsname","width":null,"editable":true,"searchable":true},

  {"field":"goodstype","width":null,"editable":true,"searchable":true},

  {"field":"packtype","width":null,"editable":true},

  {"field":"tranposid","width":null,"editable":true},

  {"field":"tranposname","width":null,"editable":false},

  {"field":"zxCustomerid","width":null,"editable":true},

  {"field":"customname","width":null,"editable":false},

  {"field":"iserp","visible":false},

  {"field":"createBy","visible":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-manage', 'grid', 'LOOKUP',

'[

  {"field":"customname","lookupCode":"customer","mapping":{"zxCustomerid":"customid","customname":"customname","tranposid":"tranposid","tranposname":"tranposname"}}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-manage', 'grid', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-manage', 'grid', 'ROW_CLASS',

'[{"field":"iserp","operator":"eq","value":1,"className":"row-confirmed"}]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-manage', 'grid', 'ROW_EDITABLE',

'[{"field":"iserp","operator":"ne","value":1}]', 'system');



-- 产品价格规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-price-manage', 'grid', 'COLUMN_OVERRIDE',

'[

  {"field":"id","visible":false,"editable":false},

  {"field":"goodsname","width":null,"editable":true,"searchable":true},

  {"field":"price","width":null,"editable":true},

  {"field":"useflag","width":null,"editable":true},

  {"field":"goodstype","width":null,"editable":true},

  {"field":"packtype","width":null,"editable":true},

  {"field":"factoryname","width":null,"editable":true},

  {"field":"iserp","width":null,"editable":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-price-manage', 'grid', 'GRID_OPTIONS',

'{"rowModelType":"infinite","cacheBlockSize":200,"maxBlocksInCache":10}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-price-manage', 'grid', 'ROW_CLASS',

'[

  {"field":"rowClassFlag","operator":"eq","value":"erp","className":"row-iserp"},

  {"field":"rowClassFlag","operator":"eq","value":"erp-updated","className":"row-iserp-updated"},

  {"field":"rowClassFlag","operator":"eq","value":"erp-price-null","className":"row-iserp-price-null"}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'goods-price-manage', 'grid', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



-- 客户/分销商规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'detailTabs', 'RELATION',

'{"masterKey":"masterGrid","detailKey":"detailTabs"}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'masterGrid', 'COLUMN_OVERRIDE',

'[

  {"field":"id","width":null,"editable":true},

  {"field":"customname","width":null,"editable":true,"searchable":true},

  {"field":"zone","width":null,"editable":true},

  {"field":"iserp","visible":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'tranposer', 'COLUMN_OVERRIDE',

'[

  {"field":"id","width":null,"editable":true},

  {"field":"customid","visible":false,"editable":false},

  {"field":"tranposname","width":null,"editable":true},

  {"field":"iserp","visible":false}

]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'masterGrid', 'ROW_CLASS',

'[{"field":"iserp","operator":"eq","value":1,"className":"row-confirmed"}]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'tranposer', 'ROW_CLASS',

'[{"field":"iserp","operator":"eq","value":1,"className":"row-confirmed"}]', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'masterGrid', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'customer-manage', 'tranposer', 'CONTEXT_MENU',

'{"items":[

  {"action":"addRow"},

  {"action":"copyRow","requiresRow":true},

  {"action":"deleteRow","requiresRow":true},

  {"type":"separator"},

  {"action":"saveGridConfig"},

  {"type":"separator"},

  {"label":"导出","items":[

    {"action":"exportSelected","requiresSelection":true},

    {"action":"exportCurrent"},

    {"action":"exportAll"},

    {"type":"separator"},

    {"action":"resetExportConfig"},

    {"action":"openHeaderConfig"}

  ]},

  {"type":"separator"},

  {"action":"save"},

  {"type":"separator"},

  {"action":"clipboard.copy"},

  {"action":"clipboard.paste"}

]}', 'system');



-- 装箱发运单页面规则

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'wms-con-doc', 'masterGrid', 'COLUMN_OVERRIDE',

'[
  {"field":"id","visible":false,"editable":false},
  {"field":"conno","width":null,"editable":false,"searchable":true},
  {"field":"customname","width":null,"editable":false,"searchable":true},
  {"field":"targetposname","width":null,"editable":false},
  {"field":"inputmanname","width":null,"editable":false}
]', 'system');


INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'wms-con-doc', 'detailTabs', 'RELATION',

'{"masterKey":"masterGrid","detailKey":"detailTabs"}', 'system');


INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'wms-con-doc', 'qty', 'COLUMN_OVERRIDE',

'[
  {"field":"id","visible":false,"editable":false},
  {"field":"conid","visible":false,"editable":false},
  {"field":"goodsid","width":null,"editable":false},
  {"field":"goodsno","width":null,"editable":false},
  {"field":"goodsname","width":null,"editable":false},
  {"field":"lotno","width":null,"editable":false},
  {"field":"packtype","width":null,"editable":false},
  {"field":"goodsqtyTotal","width":null,"editable":false},
  {"field":"goodsqtyOddtray1","width":null,"editable":false},
  {"field":"packname","width":null,"editable":false},
  {"field":"qtyShow","width":null,"editable":false}
]', 'system');


INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'wms-con-doc', 'qtyDtl', 'COLUMN_OVERRIDE',

'[
  {"field":"id","visible":false,"editable":false},
  {"field":"conid","visible":false,"editable":false},
  {"field":"goodsownid","width":null,"editable":false},
  {"field":"goodsname","width":null,"editable":false},
  {"field":"lotno","width":null,"editable":false},
  {"field":"goodsqty","width":null,"editable":false},
  {"field":"packsize","width":null,"editable":false},
  {"field":"qtyBox","width":null,"editable":false},
  {"field":"validdate","width":null,"editable":false},
  {"field":"memo","width":null,"editable":false},
  {"field":"grossWeightKg","width":null,"editable":false},
  {"field":"netWeightKg","width":null,"editable":false},
  {"field":"volumeM2","width":null,"editable":false}
]', 'system');


COMMIT;



-- D5. 基础物料表元数据 (BaseMaterial - 用于 Lookup)

DECLARE

    v_base_material_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_base_material_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES (v_base_material_id, 'BaseMaterial', '基础物料', 'T_COST_MATERIAL', 'T_COST_MATERIAL', 'SEQ_COST_MATERIAL', 'ID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'materialCode', 'MATERIAL_CODE', '物料编码', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'materialName', 'MATERIAL_NAME', '物料名称', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'useFlag', 'USE_FLAG', '物料类型', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'spec', 'SPEC', '规格', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'price', 'PRICE', '单价', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_base_material_id, 'unit', 'UNIT', '单位', 'text', 6, 'system');

    COMMIT;

END;

/





-- D6. 系统管理页面元数据



-- 用户管理表元数据

DECLARE

    v_user_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_user_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES (v_user_id, 'CostUser', '用户管理', 'T_COST_USER', 'T_COST_USER', 'SEQ_COST_USER', 'ID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'username', 'USERNAME', '用户名', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'realName', 'REAL_NAME', '姓名', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'email', 'EMAIL', '邮箱', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'phone', 'PHONE', '电话', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'departmentId', 'DEPARTMENT_ID', '部门ID', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_id, 'status', 'STATUS', '状态', 'text', 6, 'system');

    COMMIT;

END;

/



-- 角色管理表元数据

DECLARE

    v_role_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_role_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES (v_role_id, 'CostRole', '角色管理', 'T_COST_ROLE', 'T_COST_ROLE', 'SEQ_COST_ROLE', 'ID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_role_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_role_id, 'roleCode', 'ROLE_CODE', '角色编码', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_role_id, 'roleName', 'ROLE_NAME', '角色名称', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_role_id, 'description', 'DESCRIPTION', '描述', 'text', 3, 'system');

    COMMIT;

END;

/



-- 用户角色关联表元数据

DECLARE

    v_user_role_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_user_role_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES (v_user_role_id, 'CostUserRole', '角色用户', 'V_COST_USER_ROLE', 'T_COST_USER_ROLE', 'SEQ_COST_USER_ROLE', 'ID', 'CostRole', 'ROLE_ID', 'system');

    

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_role_id, 'id', 'ID', 'ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_role_id, 'roleId', 'ROLE_ID', '角色ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_role_id, 'username', 'USERNAME', '用户名', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_user_role_id, 'realName', 'REAL_NAME', '姓名', 'text', 3, 'system');

    COMMIT;

END;

/



-- D7. 外币管理元数据 (CostFormoney)

DECLARE

    v_formoney_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_formoney_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, ACTION_RULES, CREATE_BY)

    VALUES

        (v_formoney_id, 'CostFormoney', '外币管理', 'ERP_FORMONEY_V', 'T_COST_FORMONEY', 'SEQ_COST_FORMONEY', 'FMID',

         '[{"order":1,"code":"syncErpPrice","name":"同步ERP采购价","group":"manual","enabled":true,"type":"sql","sql":"UPDATE T_COST_FORMONEY SET FMOPCODE=NULL,FMNAME=NULL,FMSIGN=NULL,FMUNIT=NULL,FMRATE=NULL,USESTATUS=NULL,DELETED=NULL,CREATE_TIME=NULL,UPDATE_TIME=NULL,CREATE_BY=NULL,UPDATE_BY=NULL"}]',

         'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'id', 'FMID', '外币ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'fmopcode', 'FMOPCODE', '外币编码', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'fmname', 'FMNAME', '外币名称', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'fmsign', 'FMSIGN', '外币符号', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'fmunit', 'FMUNIT', '外币单位', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'fmrate', 'FMRATE', '外币税率', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_formoney_id, 'usestatus', 'USESTATUS', '使用状态', 'number', 6, 'system');

    COMMIT;

END;

/



-- D8. 部门管理元数据 (CostDept)

DECLARE

    v_dept_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_dept_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES

        (v_dept_id, 'CostDept', '部门管理', 'T_COST_DEPT', 'T_COST_DEPT', 'SEQ_COST_DEPT', 'DEPTID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_dept_id, 'id', 'DEPTID', '部门ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_dept_id, 'deptName', 'DEPTNAME', '部门名称', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_dept_id, 'manager', 'MANAGER', '负责人ID', 'number', 2, 'system');

    COMMIT;

END;

/



-- D9. 客户/分销商元数据 (CostCustomer / CostTranposer)

DECLARE

    v_customer_main_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_customer_main_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES

        (v_customer_main_id, 'CostCustomer', '客户信息', 'T_COST_CUSTOMER_V', 'T_COST_CUSTOMER', 'SEQ_COST_CUSTOMER', 'CUSTOMID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_main_id, 'id', 'CUSTOMID', '客户ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_main_id, 'customname', 'CUSTOMNAME', '客户名称', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_main_id, 'zone', 'ZONE', '区域', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, IS_VIRTUAL, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_main_id, 'iserp', 'ISERP', '是否ERP', 'number', 99, 1, 'system');

    COMMIT;

END;

/



DECLARE

    v_tranposer_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_tranposer_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES

        (v_tranposer_id, 'CostTranposer', '分销商信息', 'T_COST_TRANPOSER_V', 'T_COST_TRANPOSER', 'SEQ_COST_TRANPOSER', 'TRANPOSID', 'CostCustomer', 'CUSTOMID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_tranposer_id, 'id', 'TRANPOSID', '分销商ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_tranposer_id, 'customid', 'CUSTOMID', '客户ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_tranposer_id, 'tranposname', 'TRANPOSNAME', '分销商名称', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, IS_VIRTUAL, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_tranposer_id, 'iserp', 'ISERP', '是否ERP', 'number', 99, 1, 'system');

    COMMIT;

END;

/



-- D10. 客户回填视图元数据 (CostCustomerRelLookup)

DECLARE

    v_customer_rel_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_customer_rel_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES

        (v_customer_rel_id, 'CostCustomerRelLookup', '客户信息(查)', 'T_COST_CUST_TRANPOSER_REL_V', 'T_COST_CUST_TRANPOSER_REL_V', NULL, 'CUSTOMID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_rel_id, 'customname', 'CUSTOMNAME', '客户名称', 'text', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_rel_id, 'zone', 'ZONE', '区域', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_rel_id, 'tranposname', 'TRANPOSNAME', '分销商', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_rel_id, 'customid', 'CUSTOMID', '客户ID', 'number', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA

        (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES

        (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_customer_rel_id, 'tranposid', 'TRANPOSID', '分销商ID', 'number', 4, 'system');

    COMMIT;

END;

/



-- D11. 产品信息元数据 (CostGoods)

DECLARE

    v_goods_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_goods_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES

        (v_goods_id, 'CostGoods', '产品信息', 'T_COST_GOODS_V', 'T_COST_GOODS', 'SEQ_COST_GOODS', 'GOODSID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'id', 'GOODSID', '产品ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'goodsname', 'GOODSNAME', '产品名称', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'goodstype', 'GOODSTYPE', '规格', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'packtype', 'PACKTYPE', '包装规格', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'tranposid', 'TRANPOSID', '分销商ID', 'number', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'tranposname', 'TRANPOSNAME', '分销商', 'text', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'zxCustomerid', 'ZX_CUSTOMERID', '客户ID', 'number', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'customname', 'CUSTOMNAME', '客户名称', 'text', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'iserp', 'ISERP', '是否ERP', 'number', 98, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_id, 'createBy', 'CREATE_BY', '创建人', 'text', 99, 'system');

    COMMIT;

END;

/



-- D12. 产品价格元数据 (CostGoodsPrice)

DECLARE

    v_goods_price_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_goods_price_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, SEQUENCE_NAME, PK_COLUMN, CREATE_BY)

    VALUES

        (v_goods_price_id, 'CostGoodsPrice', '产品价格', 'T_COST_GOODS_PRICE_V', 'T_COST_GOODS_PRICE', 'SEQ_COST_GOODS_PRICE', 'GOODSID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'id', 'GOODSID', '产品ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'goodsname', 'GOODSNAME', '产品名称', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'price', 'PRICE', '价格', 'number', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'useflag', 'USEFLAG', '用途', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'goodstype', 'GOODSTYPE', '规格', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'packtype', 'PACKTYPE', '包装规格', 'text', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'factoryname', 'FACTORYNAME', '供应商', 'text', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_goods_price_id, 'iserp', 'ISERP', '是否ERP', 'number', 7, 'system');

    COMMIT;

END;

/



-- D13. 装箱发运单元数据 (WmsConDoc)

DECLARE

    v_wms_con_doc_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_wms_con_doc_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, PK_COLUMN, CREATE_BY)

    VALUES

        (v_wms_con_doc_id, 'WmsConDoc', '装箱发运单', 'T_WMS_CON_DOC_V', 'T_WMS_CON_DOC_V', 'CONID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_con_doc_id, 'id', 'CONID', '单据ID', 'number', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_con_doc_id, 'conno', 'CONNO', '装箱单号', 'text', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_con_doc_id, 'customname', 'CUSTOMNAME', '客户名称', 'text', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_con_doc_id, 'targetposname', 'TARGETPOSNAME', '目的地', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_con_doc_id, 'inputmanname', 'INPUTMANNAME', '录入人', 'text', 4, 'system');

    COMMIT;

END;
/



-- D14. 装箱发运数量汇总元数据 (WmsQty)

DECLARE

    v_wms_qty_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_wms_qty_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES

        (v_wms_qty_id, 'WmsQty', '装箱数量汇总', 'T_WMS_QTY_V', 'T_WMS_QTY_V', 'ID', 'WmsConDoc', 'CONID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'id', 'ID', 'ID', 'text', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'conid', 'CONID', '单据ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'goodsid', 'GOODSID', '产品ID', 'number', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'goodsno', 'GOODSNO', '产品编码', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'goodsname', 'GOODSNAME', '产品名称', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'lotno', 'LOTNO', '批号', 'text', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'packtype', 'PACKTYPE', '包装规格', 'text', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'goodsqtyTotal', 'GOODSQTY_TOTAL', '总数量', 'number', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'goodsqtyOddtray1', 'GOODSQTY_ODDTRAY1', '零头数量', 'number', 8, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'packname', 'PACKNAME', '包装单位', 'text', 9, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_id, 'qtyShow', 'QTY_SHOW', '数量展示', 'text', 10, 'system');

    COMMIT;

END;
/



-- D15. 装箱发运数量明细元数据 (WmsQtyDtl)

DECLARE

    v_wms_qty_dtl_id NUMBER;

BEGIN

    SELECT SEQ_COST_TABLE_METADATA.NEXTVAL INTO v_wms_qty_dtl_id FROM DUAL;

    INSERT INTO T_COST_TABLE_METADATA

        (ID, TABLE_CODE, TABLE_NAME, QUERY_VIEW, TARGET_TABLE, PK_COLUMN, PARENT_TABLE_CODE, PARENT_FK_COLUMN, CREATE_BY)

    VALUES

        (v_wms_qty_dtl_id, 'WmsQtyDtl', '装箱数量明细', 'T_WMS_QTY_DTL_V', 'T_WMS_QTY_DTL_V', 'ID', 'WmsConDoc', 'CONID', 'system');



    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'id', 'ID', 'ID', 'text', 0, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'conid', 'CONID', '单据ID', 'number', 1, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'goodsownid', 'GOODSOWNID', '产品ID', 'number', 2, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'goodsname', 'GOODSNAME', '产品名称', 'text', 3, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'lotno', 'LOTNO', '批号', 'text', 4, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'goodsqty', 'GOODSQTY', '数量', 'number', 5, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'packsize', 'PACKSIZE', '包装规格', 'number', 6, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'qtyBox', 'QTY_BOX', '数量（箱）', 'number', 7, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'validdate', 'VALIDDATE', '有效期', 'date', 8, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'memo', 'MEMO', '备注', 'text', 9, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'grossWeightKg', 'GROSS_WEIGHT_KG', '毛重(kg)', 'number', 10, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'netWeightKg', 'NET_WEIGHT_KG', '净重(kg)', 'number', 11, 'system');

    INSERT INTO T_COST_COLUMN_METADATA (ID, TABLE_METADATA_ID, FIELD_NAME, COLUMN_NAME, HEADER_TEXT, DATA_TYPE, DISPLAY_ORDER, CREATE_BY)

    VALUES (SEQ_COST_COLUMN_METADATA.NEXTVAL, v_wms_qty_dtl_id, 'volumeM2', 'VOLUME_M2', '体积(m2)', 'number', 12, 'system');

    COMMIT;

END;
/


-- =====================================================

-- E. 页面组件配置

-- =====================================================



-- E1. 成本评估V2 页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-pinggu-v2', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical","gap":8}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'GRID', 'root', 1, 'CostPinggu', '{"height":"50%","selectionMode":"single"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'cost-pinggu-v2', 'detailTabs', 'TABS', 'root', 2,

'{

  "mode": "multi",

  "tabs": [

    {"key": "material", "title": "原料/辅料", "tableCode": "CostMaterial"},

    {"key": "package", "title": "包材", "tableCode": "CostPackage"}

  ]

}', 'system');



-- E2. 用户管理页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'user-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'user-manage', 'grid', 'GRID', 'root', 1, 'CostUser', '{"height":"100%"}', 'system');



-- E3. 角色管理页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'role-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'role-manage', 'grid', 'GRID', 'root', 1, 'CostRole', '{"height":"100%"}', 'system');



-- E4. 外币管理页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'formoney-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical","gap":8}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'formoney-manage', 'toolbar', 'LAYOUT', 'root', 1,

'{"direction":"horizontal","gap":8,"align":"center","justify":"flex-start"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'formoney-manage', 'syncErpPrice', 'BUTTON', 'toolbar', 1,

'{"label":"同步ERP采购价","type":"primary","action":"syncErpPrice"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'formoney-manage', 'grid', 'GRID', 'root', 2, 'CostFormoney', '{"height":"100%","selectionMode":"single"}', 'system');



-- E5. 部门管理页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'dept-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'dept-manage', 'grid', 'GRID', 'root', 1, 'CostDept', '{"height":"100%"}', 'system');



-- E6. 产品信息页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'goods-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'goods-manage', 'grid', 'GRID', 'root', 1, 'CostGoods', '{"height":"100%"}', 'system');



-- E7. 产品价格页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'goods-price-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'goods-price-manage', 'grid', 'GRID', 'root', 1, 'CostGoodsPrice', '{"height":"100%"}', 'system');



-- E8. 客户/分销商页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'customer-manage', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical","gap":8}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'customer-manage', 'masterGrid', 'GRID', 'root', 1, 'CostCustomer', '{"height":"50%","selectionMode":"single"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'customer-manage', 'detailTabs', 'TABS', 'root', 2,

'{"mode":"single","tabs":[{"key":"tranposer","title":"分销商","tableCode":"CostTranposer"}]}', 'system');



-- E9. 装箱发运单页面

INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'wms-con-doc', 'root', 'LAYOUT', NULL, 0, '{"direction":"vertical","gap":8}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, REF_TABLE_CODE, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'wms-con-doc', 'masterGrid', 'GRID', 'root', 1, 'WmsConDoc', '{"height":"50%","selectionMode":"single"}', 'system');



INSERT INTO T_COST_PAGE_COMPONENT (ID, PAGE_CODE, COMPONENT_KEY, COMPONENT_TYPE, PARENT_KEY, SORT_ORDER, COMPONENT_CONFIG, CREATE_BY)

VALUES (SEQ_COST_PAGE_COMPONENT.NEXTVAL, 'wms-con-doc', 'detailTabs', 'TABS', 'root', 2,

'{
  "mode": "multi",
  "tabs": [
    {"key": "qty", "title": "数量汇总", "tableCode": "WmsQty"},
    {"key": "qtyDtl", "title": "数量明细", "tableCode": "WmsQtyDtl"}
  ]
}', 'system');



COMMIT;



-- =====================================================

-- E9. 页面规则配置（计算/聚合）

-- =====================================================



-- E9.1 原辅料公式：B / C

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'material', 'CALC',

q'~[

  {"field":"batchQty","formulaField":"formulaType","formulas":{

    "B":{"expression":"apexPl / 10000","triggerFields":["apexPl"]},

    "C":{"expression":"perHl * apexPl * (1 + exaddMater / 100) / 1000000","triggerFields":["perHl","apexPl","exaddMater"]}

  }},

  {"field":"costBatch","expression":"batchQty * price","triggerFields":["batchQty","price"]}

]~', 'system');



-- E9.2 包材公式：A / D / E / F

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'package', 'CALC',

q'~[

  {"field":"batchQty","formulaField":"formulaType","formulas":{

    "A":{"expression":"(apexPl / pPerpack) * (1 + exaddMater)","triggerFields":["apexPl","pPerpack","exaddMater"]},

    "D":{"expression":"perHl * apexPl * (1 + exaddMater / 100) / 1000000","triggerFields":["perHl","apexPl","exaddMater"]},

    "E":{"expression":"ceil(apexPl / (pPerpack * sPerback))","triggerFields":["apexPl","pPerpack","sPerback"]},

    "F":{"expression":"ceil(apexPl / (pPerpack * sPerback * xPerback))","triggerFields":["apexPl","pPerpack","sPerback","xPerback"]}

  }},

  {"field":"costBatch","expression":"batchQty * price","triggerFields":["batchQty","price"]}

]~', 'system');



-- E9.3 汇总：原料金额>0 时三类都 /1.13（严格按存储过程）

INSERT INTO T_COST_PAGE_RULE (ID, PAGE_CODE, COMPONENT_KEY, RULE_TYPE, RULES, CREATE_BY)

VALUES (SEQ_COST_PAGE_RULE.NEXTVAL, 'cost-pinggu-v2', 'masterGrid', 'AGGREGATE',

q'~[

  {"sourceField":"costBatch","targetField":"totalYl","algorithm":"SUM","sourceTab":"material","filter":"dtlUseflag === '原料'"},

  {"sourceField":"costBatch","targetField":"totalFl","algorithm":"SUM","sourceTab":"material","filter":"dtlUseflag === '辅料'"},

  {"sourceField":"costBatch","targetField":"totalBc","algorithm":"SUM","sourceTab":"package","filter":"dtlUseflag === '非印字包材' || dtlUseflag === '印字包材'"},

  {"targetField":"totalYl","expression":"totalYl > 0 ? totalYl / 1.13 : totalYl"},

  {"targetField":"totalFl","expression":"totalFl > 0 ? totalFl / 1.13 : totalFl"},

  {"targetField":"totalBc","expression":"totalBc > 0 ? totalBc / 1.13 : totalBc"},

  {"targetField":"totalCost","expression":"totalYl + totalFl + totalBc"}

]~', 'system');



COMMIT;



-- =====================================================

-- F. Lookup 配置

-- =====================================================



INSERT INTO T_COST_LOOKUP_CONFIG (ID, LOOKUP_CODE, LOOKUP_NAME, DATA_SOURCE, DISPLAY_COLUMNS, SEARCH_COLUMNS, VALUE_FIELD, LABEL_FIELD, CREATE_BY)

VALUES (SEQ_COST_LOOKUP_CONFIG.NEXTVAL, 'material', '物料选择', 'BaseMaterial',

  '[{"field":"materialCode","header":"物料编码","width":null},{"field":"materialName","header":"物料名称","width":null},{"field":"useFlag","header":"类型","width":null},{"field":"price","header":"单价","width":null}]',

  '["materialCode","materialName"]', 'id', 'materialName', 'system');



INSERT INTO T_COST_LOOKUP_CONFIG (ID, LOOKUP_CODE, LOOKUP_NAME, DATA_SOURCE, DISPLAY_COLUMNS, SEARCH_COLUMNS, VALUE_FIELD, LABEL_FIELD, CREATE_BY)

VALUES (SEQ_COST_LOOKUP_CONFIG.NEXTVAL, 'package', '包材选择', 'BaseMaterial',

  '[{"field":"materialCode","header":"包材编码","width":null},{"field":"materialName","header":"包材名称","width":null},{"field":"spec","header":"规格","width":null},{"field":"price","header":"单价","width":null}]',

  '["materialCode","materialName"]', 'id', 'materialName', 'system');



INSERT INTO T_COST_LOOKUP_CONFIG (ID, LOOKUP_CODE, LOOKUP_NAME, DATA_SOURCE, DISPLAY_COLUMNS, SEARCH_COLUMNS, VALUE_FIELD, LABEL_FIELD, CREATE_BY)

VALUES (SEQ_COST_LOOKUP_CONFIG.NEXTVAL, 'dept', '部门选择', 'CostDept',

  '[{"field":"deptName","header":"部门名称","width":null},{"field":"id","header":"部门ID","width":null},{"field":"manager","header":"负责人ID","width":null}]',

  '["deptName"]', 'id', 'deptName', 'system');



INSERT INTO T_COST_LOOKUP_CONFIG (ID, LOOKUP_CODE, LOOKUP_NAME, DATA_SOURCE, DISPLAY_COLUMNS, SEARCH_COLUMNS, VALUE_FIELD, LABEL_FIELD, CREATE_BY)

VALUES (SEQ_COST_LOOKUP_CONFIG.NEXTVAL, 'customer', '客户选择', 'CostCustomerRelLookup',

  '[{"field":"customname","header":"客户名称","width":null},{"field":"zone","header":"区域","width":null},{"field":"tranposname","header":"分销商","width":null},{"field":"customid","header":"客户ID","width":null},{"field":"tranposid","header":"分销商ID","width":null}]',

  '["customname","zone","tranposname","customid","tranposid"]', 'customid', 'customname', 'system');



COMMIT;



-- =====================================================

-- F2. 导出配置

-- =====================================================



-- 主表导出配置：产品价格页面 -> 成本评估主表
INSERT INTO T_COST_EXPORT_CONFIG (
  ID, EXPORT_CODE, EXPORT_NAME, PAGE_CODE,
  MASTER_SQL, MASTER_TABLE_ALIAS, PK_COLUMN,
  PAGE_VIEW_ALIAS, PAGE_FK_COLUMN, MASTER_LINK_COLUMN,
  COLUMNS, MASTER_SHEET_NAME,
  DISPLAY_ORDER, DELETED, CREATE_BY, CREATE_TIME, UPDATE_BY, UPDATE_TIME
) VALUES (
  SEQ_COST_EXPORT_CONFIG.NEXTVAL, 'PINGGU_FROM_GOODSPRICE', 'CostPingguFromPrice', 'goods-price-manage',
  'SELECT a.GOODSID, a.DOCID, a.GOODSNAME, a.APEX_PL FROM T_COST_PINGGU a',
  'a', 'GOODSID',
  'x', 'GOODSID', 'DOCID',
  '[{"field":"GOODSID","header":"产品ID","order":1,"visible":true},' ||
  '{"field":"DOCID","header":"ID","order":2,"visible":true},' ||
  '{"field":"GOODSNAME","header":"产品名称","order":3,"visible":true},' ||
  '{"field":"APEX_PL","header":"批量","order":4,"visible":true}]',
  'master',
  0, 0, 'system', SYSTIMESTAMP, 'system', SYSTIMESTAMP
);

-- 明细导出配置：主从通过 DOCID 关联
INSERT INTO T_COST_EXPORT_CONFIG_DETAIL (
  ID, EXPORT_CONFIG_ID, TAB_KEY, SHEET_NAME,
  DETAIL_SQL, MASTER_TABLE_ALIAS, DETAIL_TABLE_ALIAS, DETAIL_LINK_COLUMN,
  COLUMNS, DISPLAY_ORDER
)
SELECT SEQ_COST_EXPORT_CONFIG_DTL.NEXTVAL, c.ID, 'pinggu_dtl', 'detail',
       'SELECT b.* FROM T_COST_PINGGU a JOIN T_COST_PINGGU_DTL b ON a.DOCID = b.DOCID',
       'a', 'b', 'DOCID',
       '[{"field":"DTLID","header":"ID","order":1,"visible":true},' ||
       '{"field":"DOCID","header":"主表ID","order":2,"visible":true},' ||
       '{"field":"DTL_USEFLAG","header":"分类","order":3,"visible":true},' ||
       '{"field":"APEX_GOODSNAME","header":"物料名称","order":4,"visible":true},' ||
       '{"field":"SPEC","header":"规格","order":5,"visible":true},' ||
       '{"field":"PER_HL","header":"每片含量","order":6,"visible":true},' ||
       '{"field":"EXADD_MATER","header":"额外投料量","order":7,"visible":true},' ||
       '{"field":"PRICE","header":"单价","order":8,"visible":true},' ||
       '{"field":"BATCH_QTY","header":"每批数量","order":9,"visible":true},' ||
       '{"field":"COST_BATCH","header":"每批成本","order":10,"visible":true},' ||
       '{"field":"SUQTY","header":"用量","order":11,"visible":true},' ||
       '{"field":"APEX_FACTORYNAME","header":"供应商","order":12,"visible":true}]',
       0
  FROM T_COST_EXPORT_CONFIG c
 WHERE c.EXPORT_CODE = 'PINGGU_FROM_GOODSPRICE';

COMMIT;



-- =====================================================

-- G. 页面权限配置

-- =====================================================



INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'cost-pinggu-v2', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'user-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'role-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'formoney-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'dept-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'goods-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'goods-price-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'customer-manage', '["*"]', NULL, 'system');

INSERT INTO T_COST_ROLE_PAGE (ID, ROLE_ID, PAGE_CODE, BUTTON_POLICY, COLUMN_POLICY, CREATE_BY)

VALUES (SEQ_COST_ROLE_PAGE.NEXTVAL, 1, 'wms-con-doc', '["*"]', NULL, 'system');



COMMIT;



-- =====================================================

-- H. 测试数据（从 hy.apex_sa_pinggu 导入）

-- =====================================================



-- H1. 导入主表数据（取有从表数据的10条）

INSERT INTO T_COST_PINGGU (

    GOODSID, GOODSNAME, STRENGTH, MA_NO, APEX_PL, MAH, P_PERPACK, FORM, S_PERBACK, PACKTYPE,

    X_PERBACK, TOTAL_FL, TOTAL_BC, TOTAL_YL, MEMO, USESTATUS, DOCID, DOSAGE, ANNUAL_QTY, YIELD,

    TOTAL_COST, OUT_PRICE_F, OUT_PRICE_RMB, SALEMONEY, JGF_BATCH, JGF_PERQP, COST_PERQP, ML_PERQP,

    Y_JG_RE, Y_ML, Y_SALE, CUSTOMID, CUSTOMNAME, COUNTRY, PROJECTNO, USEFLAG, YIELD_TIME, APEX_PL_TIME,

    ZX_SOURCE, FMNAME, FMRATE, GOODSNAME_EN, LIVERY

)

SELECT 

    GOODSID, GOODSNAME, STRENGTH, MA_NO, APEX_PL, MAH, P_PERPACK, FORM, S_PERBACK, PACKTYPE,

    X_PERBACK, TOTAL_FL, TOTAL_BC, TOTAL_YL, MEMO, USESTATUS, DOCID, DOSAGE, ANNUAL_QTY, YIELD,

    TOTAL_COST, OUT_PRICE_F, OUT_PRICE_RMB, SALEMONEY, JGF_BATCH, JGF_PERQP, COST_PERQP, ML_PERQP,

    Y_JG_RE, Y_ML, Y_SALE, CUSTOMID, CUSTOMNAME, COUNTRY, PROJECTNO, USEFLAG, YIELD_TIME, APEX_PL_TIME,

    ZX_SOURCE, FMNAME, FMRATE, GOODSNAME_EN, LIVERY

FROM hy.apex_sa_pinggu m;



-- H2. 导入从表数据（对应主表的明细）

INSERT INTO T_COST_PINGGU_DTL (

    DOCID, APEX_GOODSID, APEX_GOODSNAME, DTL_USEFLAG, SPEC, PER_HL, EXADD_MATER, BATCH_QTY, PRICE,

    COST_BATCH, MEMO, DTLID, APEX_FACTORYNAME, APEX_FACTORYID, MODIFYDATE, ZX_SOURCE, BASE_PRICE,

    SUQTY, GOODSTYPE, GOODSNAME_EN

)

SELECT 

    d.DOCID, d.APEX_GOODSID, d.APEX_GOODSNAME, d.DTL_USEFLAG, d.SPEC, d.PER_HL, d.EXADD_MATER, d.BATCH_QTY, d.PRICE,

    d.COST_BATCH, d.MEMO, d.DTLID, d.APEX_FACTORYNAME, d.APEX_FACTORYID, d.MODIFYDATE, d.ZX_SOURCE, d.BASE_PRICE,

    d.SUQTY, d.GOODSTYPE, d.GOODSNAME_EN

FROM hy.apex_sa_pinggu_dtl d;



COMMIT;




-- =====================================================

-- 初始化完成

-- =====================================================

