# V2 功能缺失清单

> 对比 V4，V2 需要补充的功能

## 状态：✅ 全部完成

所有功能已补全，V2 已达到与 V4 功能对等。

---

## 已完成功能清单

### P0 - 核心功能

| 功能 | 说明 | V2 实现位置 |
|------|------|-------------|
| ✅ ID 映射 | 保存新增行后，后端返回真实 ID，更新前端临时 ID | `useSave.ts` → `applyIdMapping()` |
| ✅ 清除变更状态 | 保存成功后清除 `_dirtyFields`、`_isNew` 等脏标记 | `useSave.ts` → `clearRowFlags()` |

### P1 - 条件样式

| 功能 | 说明 | V2 实现位置 |
|------|------|-------------|
| ✅ 单元格变色 - 脏数据 | 用户修改/计算修改/新增/删除 单元格变色 | `cell-style.ts` → `DIRTY_CELL_CLASS_RULES` |
| ✅ 单元格变色 - 条件 | 根据元数据 STYLE_CONFIG 配置，值满足条件时变色 | `useMetaColumns.ts` → `cellClassRules` |
| ✅ 行变色 | 根据元数据 STYLE_CONFIG 配置，整行满足条件时变色 | `useMetaConfig.ts` → `masterRowClassGetter` / `detailRowClassGetterByTab` |

### P2 - 布局与过滤

| 功能 | 说明 | V2 实现位置 |
|------|------|-------------|
| ✅ 列变体过滤 | 不同 tab 根据 variantKey 显示不同列 | `useMetaConfig.ts` → `filterColumnsByVariant()` |
| ✅ 分屏模式 | NSplit 上下分隔主从表（非嵌套模式） | `MasterDetailLayoutRenderer.vue` → `NSplit` + `isSplitMode` |

### P3 - 企业版功能

| 功能 | 说明 | V2 实现位置 |
|------|------|-------------|
| ✅ Side Bar | 列选择器、过滤器侧边面板 | `grid-options.ts` → `normalizeGridOptions()` |
| ✅ 单元格选择 | 范围选择功能 | `grid-options.ts` → `cellSelection` |
| ✅ 行分组 | 按字段分组显示 | `grid-options.ts` → `applyGroupByColumns()` |
| ✅ 智能列宽 | 自动调整未配置宽度的列 | `grid-options.ts` → `autoSizeColumnsOnReady()` |

---

## V2 相比 V4 的优势

1. **代码结构清晰** - 按职责拆分为独立 composables，排查链路短
2. **配置完全解耦** - 所有配置从 `T_COST_PAGE_RULE` 读取，无硬编码
3. **扩展机制完善** - Component Extension + Save Hook 机制
4. **类型安全** - 完整的 TypeScript 类型定义
